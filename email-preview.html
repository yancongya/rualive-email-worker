<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RuAlive é‚®ä»¶æ¨¡æ¿é¢„è§ˆ</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #0f172a;
      padding: 20px;
    }
    .preview-container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }
    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    .header p {
      color: #94a3b8;
      font-size: 14px;
    }
    .preview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(640px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }
    .preview-item {
      background: #1e293b;
      border-radius: 16px;
      padding: 20px;
      border: 1px solid #334155;
    }
    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid #334155;
    }
    .preview-title {
      color: #e2e8f0;
      font-size: 18px;
      font-weight: 600;
    }
    .toggle-btn {
      background: #334155;
      color: #e2e8f0;
      border: 1px solid #475569;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }
    .toggle-btn:hover {
      background: #475569;
      transform: translateY(-1px);
    }
    .preview-content {
      background: #f9f1f1;
      border-radius: 12px;
      overflow: hidden;
    }
    .preview-content iframe {
      width: 100%;
      height: 900px;
      border: none;
    }
    .instructions {
      background: #1e293b;
      border-radius: 16px;
      padding: 24px;
      border: 1px solid #334155;
      color: #94a3b8;
      font-size: 14px;
      line-height: 1.8;
    }
    .instructions h3 {
      color: #e2e8f0;
      margin-bottom: 12px;
      font-size: 16px;
    }
    .instructions ul {
      margin-left: 24px;
    }
    .instructions li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <div class="preview-container">
    <div class="header">
      <h1>ğŸ“§ RuAlive é‚®ä»¶æ¨¡æ¿é¢„è§ˆ</h1>
      <p>åŸºäºæ‚¨æä¾›çš„ç®€æ´å®ç”¨è®¾è®¡</p>
    </div>

    <div class="instructions">
      <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
      <ul>
        <li>ç‚¹å‡»"åˆ·æ–°é¢„è§ˆ"æŒ‰é’®æŸ¥çœ‹æœ€æ–°çš„é‚®ä»¶æ¨¡æ¿æ•ˆæœ</li>
        <li>ä¿®æ”¹ <code>src/templates/daily-summary-email.js</code> æˆ– <code>src/templates/warning-email.js</code> ååˆ·æ–°å³å¯çœ‹åˆ°æ•ˆæœ</li>
        <li>ä½¿ç”¨è®¾ç½®é¡µé¢çš„"æµ‹è¯•æ“ä½œå‘˜"æŒ‰é’®å‘é€æµ‹è¯•é‚®ä»¶</li>
      </ul>
    </div>

    <div class="preview-grid">
      <div class="preview-item">
        <div class="preview-header">
          <span class="preview-title">å·¥ä½œæ€»ç»“é‚®ä»¶ï¼ˆç®€æ´ç‰ˆï¼‰</span>
          <button class="toggle-btn" onclick="refreshSummary()">åˆ·æ–°é¢„è§ˆ</button>
        </div>
        <div class="preview-content">
          <iframe id="summary-preview" title="å·¥ä½œæ€»ç»“é¢„è§ˆ"></iframe>
        </div>
      </div>

      <div class="preview-item">
        <div class="preview-header">
          <span class="preview-title">å·¥ä½œè­¦å‘Šé‚®ä»¶ï¼ˆç®€æ´ç‰ˆï¼‰</span>
          <button class="toggle-btn" onclick="refreshWarning()">åˆ·æ–°é¢„è§ˆ</button>
        </div>
        <div class="preview-content">
          <iframe id="warning-preview" title="å·¥ä½œè­¦å‘Šé¢„è§ˆ"></iframe>
        </div>
      </div>
    </div>

    <div class="preview-grid">
      <div class="preview-item">
        <div class="preview-header">
          <span class="preview-title">å·¥ä½œæ€»ç»“é‚®ä»¶ï¼ˆå¹½é»˜ç‰ˆï¼‰</span>
          <button class="toggle-btn" onclick="refreshSummaryHumor()">åˆ·æ–°é¢„è§ˆ</button>
        </div>
        <div class="preview-content">
          <iframe id="summary-humor-preview" title="å·¥ä½œæ€»ç»“å¹½é»˜ç‰ˆé¢„è§ˆ"></iframe>
        </div>
      </div>

      <div class="preview-item">
        <div class="preview-header">
          <span class="preview-title">å·¥ä½œè­¦å‘Šé‚®ä»¶ï¼ˆå¹½é»˜ç‰ˆï¼‰</span>
          <button class="toggle-btn" onclick="refreshWarningHumor()">åˆ·æ–°é¢„è§ˆ</button>
        </div>
        <div class="preview-content">
          <iframe id="warning-humor-preview" title="å·¥ä½œè­¦å‘Šå¹½é»˜ç‰ˆé¢„è§ˆ"></iframe>
        </div>
      </div>
    </div>
  </div>

  <script>
    // æ¨¡æ‹Ÿç”¨æˆ·æ•°æ®
    const mockUser = {
      username: 'çƒŸå›±é¸­',
      email: '2655283737@qq.com'
    };

    // æ¨¡æ‹Ÿå·¥ä½œæ•°æ®ï¼ˆä½å·¥ä½œé‡åœºæ™¯ï¼‰
    const mockWorkDataWarning = {
      work_hours: 2.5,
      project_count: 1,
      composition_count: 8,
      keyframe_count: 45,
      layer_count: 32,
      effect_count: 15,
      last_work_date: '2026å¹´1æœˆ30æ—¥'
    };

    // æ¨¡æ‹Ÿå·¥ä½œæ•°æ®ï¼ˆæ­£å¸¸åœºæ™¯ï¼‰
    const mockWorkDataSummary = {
      work_hours: 0.59,
      project_count: 1,
      composition_count: 25,
      keyframe_count: 568,
      layer_count: 229,
      effect_count: 120,
      last_work_date: '2026å¹´1æœˆ30æ—¥'
    };

    // æ¨¡æ‹Ÿé…ç½®
    const mockConfig = {
      thresholds: {
        minWorkHours: 8,
        minKeyframes: 50,
        minJsonSize: 10
      },
      emergency_name: 'çƒŸå›±é¸­',
      emergency_email: '2655283737@qq.com'
    };

    // å·¥ä½œæ€»ç»“é‚®ä»¶æ¨¡æ¿
    function generateDailySummaryEmail(user, workData, config) {
      const username = user?.username || 'åŒäº‹';
      const email = user?.email || '';

      const workHours = Number(workData?.work_hours) || 0;
      const projectCount = workData?.project_count || 0;
      const compositionCount = workData?.composition_count || 0;
      const keyframeCount = workData?.keyframe_count || 0;
      const layerCount = workData?.layer_count || 0;
      const effectCount = workData?.effect_count || 0;
      const lastWorkDate = workData?.last_work_date || 'â€”';

      const emergencyName = config?.emergency_name || 'ç®¡ç†å‘˜';
      const emergencyEmail = config?.emergency_email || 'admin@example.com';
      const minWorkHours = Number(config?.thresholds?.minWorkHours) || 6;

      const today = new Date();
      const dateStr = today.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });

      const hoursText = workHours >= 1 ? `${workHours}å°æ—¶` : `${Math.round(workHours * 60)}åˆ†é’Ÿ`;
      const isLowWorkTime = workHours < minWorkHours;

      return `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¯æ—¥å·¥ä½œç®€æŠ¥ - ${dateStr}</title>
</head>
<body style="margin:0; padding:0; background-color:#f4f4f9; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">

  <table role="presentation" width="100%" border="0" cellspacing="0" cellpadding="0" style="background-color:#f4f4f9; padding:20px 0;">
    <tr>
      <td align="center">
        <table role="presentation" width="100%" style="max-width:600px; background:#ffffff; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.08);">
          <tr>
            <td style="background: linear-gradient(135deg, #6366f1, #8b5cf6); padding:32px 24px; text-align:center; color:white;">
              <h1 style="margin:0; font-size:28px; font-weight:600;">æ¯æ—¥å·¥ä½œç®€æŠ¥</h1>
              <p style="margin:12px 0 0; font-size:15px; opacity:0.95;">${dateStr}</p>
            </td>
          </tr>
          <tr>
            <td style="padding:32px 24px 16px; font-size:16px; line-height:1.6; color:#1f2937;">
              <p style="margin:0 0 20px;">Hiï¼Œ<strong>${username}</strong></p>
              <p style="margin:0;">è¿™æ˜¯ä½ ä»Šå¤©çš„åˆ›ä½œæ•°æ®å°ç»“ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï½</p>
            </td>
          </tr>
          <tr>
            <td style="padding:0 24px 32px;">
              <table role="presentation" width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td style="padding:0 6px 12px; width:50%; box-sizing:border-box;">
                    <div style="background:#f0f9ff; border-radius:10px; padding:20px 16px; text-align:center; border:1px solid #bae6fd;">
                      <div style="font-size:28px; font-weight:700; color:#0369a1;">${hoursText}</div>
                      <div style="margin-top:8px; font-size:14px; color:#475569;">ä»Šæ—¥å·¥ä½œæ—¶é•¿</div>
                      ${
                        isLowWorkTime
                          ? `<div style="margin-top:10px; font-size:13px; color:#dc2626; font-weight:500;">ä½äºç›®æ ‡ ${minWorkHours} å°æ—¶</div>`
                          : `<div style="margin-top:10px; font-size:13px; color:#16a34a;">è¾¾æˆç›®æ ‡</div>`
                      }
                    </div>
                  </td>
                  <td style="padding:0 6px 12px; width:50%; box-sizing:border-box;">
                    <div style="background:#f0fdf4; border-radius:10px; padding:20px 16px; text-align:center; border:1px solid #bbf7d0;">
                      <div style="font-size:28px; font-weight:700; color:#15803d;">${projectCount}</div>
                      <div style="margin-top:8px; font-size:14px; color:#475569;">ä»Šæ—¥é¡¹ç›®æ•°</div>
                    </div>
                  </td>
                </tr>
                <tr>
                  <td style="padding:0 6px; width:50%;">
                    <div style="background:#fefce8; border-radius:10px; padding:16px; text-align:center; border:1px solid #fef08a;">
                      <div style="font-size:24px; font-weight:600; color:#a16207;">${compositionCount}</div>
                      <div style="font-size:13px; color:#713f12; margin-top:4px;">åˆæˆæ•°é‡</div>
                    </div>
                  </td>
                  <td style="padding:0 6px; width:50%;">
                    <div style="background:#f3e8ff; border-radius:10px; padding:16px; text-align:center; border:1px solid #e9d5ff;">
                      <div style="font-size:24px; font-weight:600; color:#7e22ce;">${keyframeCount}</div>
                      <div style="font-size:13px; color:#6b21a8; margin-top:4px;">å…³é”®å¸§æ•°é‡</div>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td style="padding:0 24px 24px; font-size:14px; color:#4b5563;">
              <table role="presentation" width="100%" border="0" cellspacing="0" cellpadding="8" style="background:#f8fafc; border-radius:8px;">
                <tr>
                  <td>å›¾å±‚æ€»æ•°</td>
                  <td align="right"><strong>${layerCount}</strong></td>
                </tr>
                <tr>
                  <td>ç‰¹æ•ˆä½¿ç”¨æ¬¡æ•°</td>
                  <td align="right"><strong>${effectCount}</strong></td>
                </tr>
                <tr>
                  <td>æœ€åå·¥ä½œæ—¥æœŸ</td>
                  <td align="right"><strong>${lastWorkDate}</strong></td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td style="padding:24px; background:#f1f5f9; text-align:center; font-size:14px; color:#4b5563; border-top:1px solid #e2e8f0;">
              <p style="margin:0 0 16px;">
                å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–éœ€è¦ååŠ©ï¼Œæ¬¢è¿éšæ—¶è”ç³»ï¼š
                <br><strong>${emergencyName}</strong> 
                <a href="mailto:${emergencyEmail}" style="color:#6366f1; text-decoration:none;">${emergencyEmail}</a>
              </p>
              <p style="margin:16px 0 0; font-size:13px; color:#6b7280;">
                è¿™æ˜¯ä¸€å°è‡ªåŠ¨å‘é€çš„é‚®ä»¶ï¼Œè¯·å‹¿ç›´æ¥å›å¤ã€‚
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
  `.trim();
    }

    // å·¥ä½œè­¦å‘Šé‚®ä»¶æ¨¡æ¿
    function generateWarningEmail(user, workData, config) {
      const username = user?.username || 'åŒäº‹';
      const email = user?.email || '';

      const workHours = Number(workData?.work_hours) || 0;
      const projectCount = workData?.project_count || 0;
      const lastWorkDate = workData?.last_work_date || 'â€”';

      const emergencyName = config?.emergency_name || 'ç®¡ç†å‘˜';
      const emergencyEmail = config?.emergency_email || 'admin@example.com';
      const minWorkHours = Number(config?.thresholds?.minWorkHours) || 6;

      const today = new Date();
      const dateStr = today.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });

      const hoursText = workHours >= 1 ? `${workHours}å°æ—¶` : `${Math.round(workHours * 60)}åˆ†é’Ÿ`;
      const shortfall = Math.max(0, minWorkHours - workHours);
      const shortfallText = shortfall > 0 ? `ï¼ˆè¿˜å·® ${shortfall} å°æ—¶ï¼‰` : '';

      return `
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å·¥ä½œæé†’ - ${dateStr}</title>
</head>
<body style="margin:0; padding:0; background-color:#f9f1f1; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">

  <table role="presentation" width="100%" border="0" cellspacing="0" cellpadding="0" style="background-color:#f9f1f1; padding:20px 0;">
    <tr>
      <td align="center">
        <table role="presentation" width="100%" style="max-width:600px; background:#ffffff; border-radius:12px; overflow:hidden; box-shadow:0 4px 16px rgba(0,0,0,0.1);">
          <tr>
            <td style="background: linear-gradient(135deg, #ef4444, #f87171); padding:32px 24px; text-align:center; color:white;">
              <h1 style="margin:0; font-size:30px; font-weight:700;">å·¥ä½œæé†’</h1>
              <p style="margin:12px 0 0; font-size:16px; opacity:0.95;">${dateStr}</p>
            </td>
          </tr>
          <tr>
            <td style="padding:32px 24px 20px; font-size:16px; line-height:1.6; color:#1f2937;">
              <p style="margin:0 0 20px;">Hiï¼Œ<strong>${username}</strong></p>
              <p style="margin:0 0 24px; font-weight:500; color:#991b1b;">
                ç³»ç»Ÿæ£€æµ‹åˆ°æ‚¨ä»Šæ—¥çš„å·¥ä½œæ—¶é•¿ <strong style="color:#b91c1c; font-size:1.15em;">${hoursText}</strong> ${shortfallText}ï¼Œ
                <br>æ˜æ˜¾ä½äºå…¬å¸æœ€ä½ç›®æ ‡ï¼ˆ${minWorkHours}å°æ—¶ï¼‰ã€‚
              </p>
              <p style="margin:0 0 16px;">
                è¿™å¯èƒ½ä¼šå½±å“é¡¹ç›®è¿›åº¦ä¸å›¢é˜Ÿæ•´ä½“è®¡åˆ’ã€‚
                è¯·åˆç†å®‰æ’æ—¶é—´ï¼Œå°½å¿«è¡¥è¶³ä»Šæ—¥å·¥ä½œé‡ï¼Œæˆ–è¯´æ˜æƒ…å†µã€‚
              </p>
            </td>
          </tr>
          <tr>
            <td style="padding:0 24px 32px;">
              <table role="presentation" width="100%" border="0" cellspacing="0" cellpadding="0">
                <tr>
                  <td style="padding:0 8px; width:50%;">
                    <div style="background:#fef2f2; border-radius:10px; padding:20px 16px; text-align:center; border:1px solid #fecaca;">
                      <div style="font-size:32px; font-weight:700; color:#b91c1c;">${hoursText}</div>
                      <div style="margin-top:8px; font-size:14px; color:#7f1d1d;">ä»Šæ—¥å·¥ä½œæ—¶é•¿</div>
                      <div style="margin-top:10px; font-size:13px; color:#991b1b; font-weight:500;">æœªè¾¾æ ‡</div>
                    </div>
                  </td>
                  <td style="padding:0 8px; width:50%;">
                    <div style="background:#fefce8; border-radius:10px; padding:20px 16px; text-align:center; border:1px solid #fef08a;">
                      <div style="font-size:32px; font-weight:700; color:#a16207;">${projectCount}</div>
                      <div style="margin-top:8px; font-size:14px; color:#713f12;">ä»Šæ—¥é¡¹ç›®æ•°</div>
                    </div>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr>
            <td style="padding:0 24px 32px; text-align:center;">
              <p style="margin:0 0 20px; font-size:15px; color:#374151; font-weight:500;">
                è¯·åœ¨24å°æ—¶å†…ï¼š
              </p>
              <p style="margin:0 0 28px; font-size:15px; line-height:1.5;">
                1. ç»§ç»­å®Œæˆä»Šæ—¥å‰©ä½™å·¥ä½œ<br>
                2. æˆ–å›å¤æœ¬é‚®ä»¶ / è”ç³»ä¸‹æ–¹äººå‘˜è¯´æ˜æƒ…å†µ
              </p>
              <a href="mailto:${emergencyEmail}" style="display:inline-block; padding:14px 32px; background:#dc2626; color:white; font-weight:600; text-decoration:none; border-radius:8px; font-size:16px;">
                ç«‹å³è”ç³» ${emergencyName}
              </a>
            </td>
          </tr>
          <tr>
            <td style="padding:24px; background:#f1f5f9; text-align:center; font-size:14px; color:#4b5563; border-top:1px solid #e2e8f0;">
              <p style="margin:0 0 16px;">
                å¦‚æœ‰ç‰¹æ®Šæƒ…å†µï¼Œè¯·å°½å¿«è”ç³»ï¼š
                <br><strong>${emergencyName}</strong> 
                <a href="mailto:${emergencyEmail}" style="color:#dc2626; text-decoration:none; font-weight:500;">${emergencyEmail}</a>
              </p>
              <p style="margin:16px 0 0; font-size:13px; color:#6b7280;">
                è¿™æ˜¯ä¸€å°è‡ªåŠ¨å‘é€çš„æé†’é‚®ä»¶ï¼Œè¯·å‹¿ç›´æ¥å›å¤ï¼ˆé™¤éè¯´æ˜æƒ…å†µï¼‰ã€‚
              </p>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
  `.trim();
    }

    // åˆ·æ–°å·¥ä½œæ€»ç»“é¢„è§ˆ
    function refreshSummary() {
      const iframe = document.getElementById('summary-preview');
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(generateDailySummaryEmail(mockUser, mockWorkDataSummary, mockConfig));
      doc.close();
    }

    // åˆ·æ–°å·¥ä½œè­¦å‘Šé¢„è§ˆ
    function refreshWarning() {
      const iframe = document.getElementById('warning-preview');
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(generateWarningEmail(mockUser, mockWorkDataWarning, mockConfig));
      doc.close();
    }

    // å·¥ä½œæ€»ç»“é‚®ä»¶æ¨¡æ¿ï¼ˆå¹½é»˜ç‰ˆï¼‰
    function generateDailySummaryHumorEmail(user, workData, config) {
      const username = user?.username || 'åŒäº‹';
      const email = user?.email || '';

      const workHours = Number(workData?.work_hours) || 0;
      const projectCount = workData?.project_count || 0;
      const compositionCount = workData?.composition_count || 0;
      const keyframeCount = workData?.keyframe_count || 0;
      const layerCount = workData?.layer_count || 0;
      const effectCount = workData?.effect_count || 0;
      const lastWorkDate = workData?.last_work_date || 'â€”';

      const emergencyName = config?.emergency_name || 'ç®¡ç†å‘˜';
      const emergencyEmail = config?.emergency_email || 'admin@example.com';
      const minWorkHours = Number(config?.thresholds?.minWorkHours) || 6;

      const today = new Date();
      const dateStr = today.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });

      const hoursDecimal = workHours.toFixed(1);
      const minutes = Math.round((workHours % 1) * 60);

      return `
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>å·¥ä½œæ—¥æŠ¥</title></head>
<body style="margin:0;padding:0;background-color:#0a0a0a;color:#eeeeee;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;-webkit-font-smoothing:antialiased;">
<table width="100%" border="0" cellpadding="0" cellspacing="0" style="background-color:#0a0a0a;">
<tr><td align="center" style="padding:24px 16px;">
  <table width="100%" border="0" cellpadding="0" cellspacing="0" style="width:100%;max-width:600px;background:#1a1a1a;border:1px solid #333333;border-radius:8px;overflow:hidden;margin:0 auto;">
    
    <!-- Header -->
    <tr><td style="padding:16px 12px;background:#FF6B35;color:#000000;text-align:center;font-weight:800;font-size:16px;letter-spacing:-0.5px;">
      <div style="display:flex;align-items:center;justify-content:center;gap:8px;overflow:hidden;">
        <div style="flex-shrink:0;">ğŸ“„</div>
        <span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">[æ—¥æŠ¥] ${dateStr} æ‘†çƒ‚æ—¥æŠ¥</span>
      </div>
    </td></tr>

    <!-- Body -->
    <tr><td style="padding:24px 24px 12px 24px;line-height:1.6;font-size:15px;color:#cccccc;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
        <div style="flex-shrink:0;">ğŸ‘¤</div>
        <span style="font-size:18px;font-weight:bold;color:#ffffff;">å“ˆå–½ ${username}ï¼Œä»Šå¤©æ˜¯åœ¨å·¥ä½ä¸Šä»°å§èµ·åäº†å—ï¼Ÿ</span>
      </div>
      
      <p style="margin:0 0 12px;">å·¥æ—¶ <span style="color:#FF6B35;font-weight:bold;">${hoursDecimal}</span> å°æ—¶ã€‚å±äºæ˜¯é‚£ç§"è™½ç„¶æ²¡å¤§ç”¨ä½†ä¹Ÿä¸èƒ½æŠŠä½ å¼€äº†"çš„æ°´å¹³ã€‚</p>
      <p style="margin:0;">ä¸ºäº†æˆ¿è´·è½¦è´·ï¼Œæ˜å¤©å†æ¼”å¾—åƒä¸€ç‚¹å§ã€‚</p>
      
    </td></tr>

    <!-- Highlight Metric -->
    <tr><td align="center" style="padding:0 24px 24px;">
       <div style="background:#252525;border:1px dashed #444;border-radius:8px;padding:12px;display:inline-block;min-width:200px;text-align:center;">
          <div style="margin-bottom:4px;display:flex;align-items:center;justify-content:center;gap:6px;">
             <div style="flex-shrink:0;">â°</div> <span style="color:#888;font-size:12px;">ä»Šæ—¥æœ‰æ•ˆå·¥æ—¶</span>
          </div>
          <span style="color:#fff;font-size:24px;font-weight:bold;">${Math.floor(workHours)}å°æ—¶ ${minutes}åˆ†é’Ÿ</span>
       </div>
    </td></tr>

    <!-- Data Grid -->
    <tr><td style="padding:0 24px 24px;">
    <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:separate;border-spacing:8px;">
      <tr>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;font-size:24px;">ğŸ“</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">é¡¹ç›®æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${projectCount}</span>
        </td>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;font-size:24px;">ğŸï¸</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">åˆæˆæ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${compositionCount}</span>
        </td>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;font-size:24px;">ğŸ’</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">å…³é”®å¸§</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${keyframeCount}</span>
        </td>
      </tr>
      <tr><td colspan="3" height="4"></td></tr>
      <tr>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;font-size:24px;">ğŸ“š</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">å›¾å±‚æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${layerCount}</span>
        </td>
        <td colspan="2" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;font-size:24px;">âœ¨</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">ç‰¹æ•ˆæ€»æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${effectCount}</span>
        </td>
      </tr>
    </table>
  </td></tr>

    <!-- Footer Meta -->
    <tr><td style="padding:0 24px 24px;text-align:center;">
      <span style="font-size:12px;color:#666;">æœ€åä¸€æ¬¡å‡è£…åœ¨å·¥ä½œ: <span style="color:#999;">${lastWorkDate}</span></span>
    </td></tr>

    <!-- CTA (Integrated into body) -->
    <tr><td style="padding:0 20px 32px;text-align:center;">
       <!-- Divider -->
       <div style="height:1px;background:#333;margin:0 12px 24px;"></div>
       
       <div style="margin:0 0 16px;font-size:14px;color:#bbb;font-weight:bold;display:flex;align-items:center;justify-content:center;gap:6px;">
         <span>ä¸‹ç­äº†ä¸‹ç­äº†ï¼ˆå¹¶ä¸æ˜¯ï¼‰</span> 
         <span style="font-size:16px;">ğŸƒ</span>
      </div>
       
      <!-- Action Button Style Link -->
      <table align="center" cellspacing="0" cellpadding="0">
        <tr>
          <td align="center" style="border-radius: 4px; border: 1px solid #444; background: #222;">
            <a href="mailto:${emergencyEmail}" style="font-size: 13px; font-family: Helvetica, Arial, sans-serif; color: #eeeeee; text-decoration: none; padding: 10px 20px; display: inline-block;">
              ğŸš’ æœ‰äº‹æ‰¾æ•‘ç«é˜Ÿé•¿: ${emergencyName}
            </a>
          </td>
        </tr>
      </table>
       
    </td></tr>
  </table>

  <!-- Signature (Outside Card) -->
  <p style="margin:16px 0 0;text-align:center;font-size:11px;color:#444;">
    RuAlive v6 Â· è‡ªåŠ¨é˜´é˜³ç³»ç»Ÿ Â· åˆ«å›æˆ‘ï¼ˆdogeï¼‰<br><span style="opacity:0.5">Generated by AI</span>
  </p>

</td></tr></table></body></html>
  `.trim();
    }

    // å·¥ä½œè­¦å‘Šé‚®ä»¶æ¨¡æ¿ï¼ˆå¹½é»˜ç‰ˆï¼‰
    function generateWarningHumorEmail(user, workData, config) {
      const username = user?.username || 'åŒäº‹';
      const email = user?.email || '';

      const workHours = Number(workData?.work_hours) || 0;
      const projectCount = workData?.project_count || 0;
      const compositionCount = workData?.composition_count || 0;
      const keyframeCount = workData?.keyframe_count || 0;
      const layerCount = workData?.layer_count || 0;
      const effectCount = workData?.effect_count || 0;
      const lastWorkDate = workData?.last_work_date || 'â€”';

      const emergencyName = config?.emergency_name || 'ç®¡ç†å‘˜';
      const emergencyEmail = config?.emergency_email || 'admin@example.com';
      const minWorkHours = Number(config?.thresholds?.minWorkHours) || 6;

      const today = new Date();
      const dateStr = today.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });

      const hoursDecimal = workHours.toFixed(1);
      const minutes = Math.round((workHours % 1) * 60);

      return `
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>äº²å‹é¢„è­¦é€šçŸ¥</title></head>
<body style="margin:0;padding:0;background-color:#0a0a0a;color:#eeeeee;font-family:system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;-webkit-font-smoothing:antialiased;">
<table width="100%" border="0" cellpadding="0" cellspacing="0" style="background-color:#0a0a0a;">
<tr><td align="center" style="padding:24px 16px;">
  <table width="100%" border="0" cellpadding="0" cellspacing="0" style="width:100%;max-width:600px;background:#1a1a1a;border:2px solid #FF3535;border-radius:8px;overflow:hidden;margin:0 auto;">
    
    <!-- Header -->
    <tr><td style="padding:16px 12px;background:#FF3535;color:#000000;text-align:center;font-weight:800;font-size:16px;letter-spacing:-0.5px;">
      <div style="display:flex;align-items:center;justify-content:center;gap:8px;overflow:hidden;">
        <div style="flex-shrink:0;font-size:24px;">âš ï¸</div>
        <span style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">[å‘ŠçŠ¶] æ‚¨çš„æœ‹å‹ ${username} å¿«æ²¡äº†</span>
      </div>
    </td></tr>

    <!-- Body -->
    <tr><td style="padding:24px 24px 12px 24px;line-height:1.6;font-size:15px;color:#cccccc;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
        <div style="flex-shrink:0;font-size:24px;">ğŸš¨</div>
        <span style="font-size:18px;font-weight:bold;color:#ffffff;">è‡´ ${emergencyName} <span style="font-size:12px;opacity:0.6;font-weight:normal;">(æ•‘ç«é˜Ÿå‘˜)</span>:</span>
      </div>
      
      <!-- Skull Decoration -->
      <div style="float:right; margin-left:16px; opacity:0.8; transform: rotate(10deg); font-size:48px;">ğŸ’€</div>
      
      
    <p style="margin:0 0 12px;">å¾ˆæŠ±æ­‰ä»¥è¿™ç§æ–¹å¼æ‰“æ‰°ä½ ã€‚ç³»ç»Ÿåœ¨ <strong>${username}</strong> çš„"èŒä¸šç”Ÿæ¶¯é¢„è­¦"è®¾ç½®é‡Œå‘ç°äº†ä½ çš„è”ç³»æ–¹å¼ã€‚</p>
    <p style="margin:0 0 12px;">æˆ‘ä»¬å®åœ¨æ²¡æ‹›äº†ã€‚è¿™ä½å¤§ç¥ä»Šå¤©åªå·¥åšäº† <span style="color:#FF6B35;font-weight:bold;font-size:18px;">${hoursDecimal}</span> å°æ—¶ã€‚</p>
    <p style="margin:0;">ç³»ç»ŸåŸæœ¬æƒ³ç›´æ¥æŠ¥è­¦ï¼ˆè¯¯ï¼‰ï¼Œä½†è§‰å¾—è¿˜æ˜¯å…ˆé€šçŸ¥ä½ æ¯”è¾ƒå¥½ã€‚çœ‹æ¥ä»–/å¥¹æœ€è¿‘ä¸ä»…æ˜¯åœ¨æ‘¸é±¼ï¼Œç®€ç›´æ˜¯åœ¨å½“æµ·ç‹ã€‚ğŸŸ</p>
    
    <div style="margin:16px 0; padding:12px; background:rgba(255,53,53,0.1); border-left:3px solid #FF3535; font-size:13px; color:#ffaaaa;">
      <strong>AI ç”šè‡³æ€€ç–‘ï¼š</strong><br>
      1. é”®ç›˜è¢«çŒ«è¸©åäº†<br>
      2. äººè¢«å¤–æ˜ŸäººæŠ“èµ°äº†<br>
      3. æ­£åœ¨ç»™ã€Šé»‘ç¥è¯ï¼šæ‚Ÿç©ºã€‹è´¡çŒ®æ—¥æ´»
    </div>

    <p style="margin:0; display:flex; align-items:center; gap:8px;">
      <span style="font-size:20px;">ğŸ”¥</span> <span>ä½œä¸ºç›‘æŠ¤äººï¼ˆæœ‹å‹ï¼‰ï¼Œè¿™è¾¹å»ºè®®æ‚¨ç›´æ¥ä¸€ä¸ªç”µè¯è¿‡å»éª‚é†’ä»–ã€‚</span>
    </p>
  
    </td></tr>

    <!-- Highlight Metric for Friend to See -->
    <tr><td align="center" style="padding:0 24px 24px;">
       <div style="background:#301111;border:1px dashed #FF3535;border-radius:8px;padding:12px;display:inline-block;min-width:200px;text-align:center;">
          <span style="color:#aa5555;font-size:12px;">${username} çš„æ‘†çƒ‚å®å½•</span><br>
          <span style="color:#fff;font-size:24px;font-weight:bold;">${Math.floor(workHours)}å°æ—¶ ${minutes}åˆ†é’Ÿ</span>
       </div>
    </td></tr>

    <!-- Data Grid -->
    <tr><td style="padding:0 24px 24px;">
    <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:separate;border-spacing:8px;">
      <tr>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;height:24px;font-size:24px;">ğŸ“</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">é¡¹ç›®æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${projectCount}</span>
        </td>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;height:24px;font-size:24px;">ğŸï¸</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">åˆæˆæ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${compositionCount}</span>
        </td>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;height:24px;font-size:24px;">ğŸ’</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">å…³é”®å¸§</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${keyframeCount}</span>
        </td>
      </tr>
      <tr><td colspan="3" height="4"></td></tr>
      <tr>
        <td width="33%" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;height:24px;font-size:24px;">ğŸ“š</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">å›¾å±‚æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${layerCount}</span>
        </td>
        <td colspan="2" style="background:#222;border-radius:6px;padding:12px;text-align:center;vertical-align:top;">
          <div style="margin-bottom:6px;height:24px;font-size:24px;">âœ¨</div>
          <span style="color:#888888;font-size:11px;text-transform:uppercase;letter-spacing:1px;margin-top:4px;display:block;">ç‰¹æ•ˆæ€»æ•°</span>
          <span style="color:#eeeeee;font-size:16px;font-weight:bold;margin-top:2px;display:block;">${effectCount}</span>
        </td>
      </tr>
    </table>
  </td></tr>

    <!-- Footer Meta -->
    <tr><td style="padding:0 24px 24px;text-align:center;">
      <span style="font-size:12px;color:#666;">ç³»ç»Ÿæ£€æµ‹åˆ°æœ€åä¸€æ¬¡å¾®å¼±çš„ç”Ÿå‘½è¿¹è±¡: <span style="color:#999;">${lastWorkDate}</span></span>
    </td></tr>

    <!-- CTA (Integrated) -->
    <tr><td style="padding:0 20px 32px;text-align:center;">
       <!-- Divider -->
       <div style="height:1px;background:#444444;margin:0 12px 24px;"></div>
       
       <p style="margin:0 0 16px;font-size:14px;color:#ff8888;font-weight:bold;">åˆ«è®©æˆ‘ä»¬éš¾åšï¼Œå¿«å»æäººï¼</p>
       
      <!-- Action Buttons -->
      <table align="center" cellspacing="0" cellpadding="0">
        <tr>
          <td align="center" style="border-radius: 4px;" bgcolor="#FF6B35">
            <a href="mailto:${email}?subject=ä½ è¢«ç³»ç»Ÿé€šæŠ¥äº†&body=å¤§å“¥ï¼Œç³»ç»Ÿå‘é‚®ä»¶ç»™æˆ‘è¯´ä½ åªå·¥ä½œäº†${hoursDecimal}å°æ—¶ï¼Œä½ è¿˜å¥½å—ï¼Ÿ" target="_blank" style="font-size: 13px; font-family: Helvetica, Arial, sans-serif; color: #000000; text-decoration: none; padding: 10px 20px; border: 1px solid #FF6B35; display: inline-block; font-weight: bold;">
              ğŸ“© å‘é‚®ä»¶éª‚ä»–/å¥¹
            </a>
          </td>
        </tr>
      </table>
       
      <p style="margin:16px 0 0;font-size:11px;color:#555;">(å¦‚æœä¸ç‚¹å‡»ï¼Œç³»ç»Ÿå¯èƒ½ä¼šè‡ªåŠ¨å°†æ­¤äººç®€å†æŠ•é€’ç»™ç«äº‰å¯¹æ‰‹)</p>
    </td></tr>
  </table>

  <!-- Signature (Outside Card) -->
  <p style="margin:16px 0 0;text-align:center;font-size:11px;color:#444;">
    RuAlive v6 Â· è‡ªåŠ¨å‘ŠçŠ¶ç³»ç»Ÿ Â· è«å¾—æ„Ÿæƒ…<br><span style="opacity:0.5">Generated by AI</span>
  </p>
</td></tr></table></body></html>
  `.trim();
    }

    // åˆ·æ–°å·¥ä½œæ€»ç»“å¹½é»˜ç‰ˆé¢„è§ˆ
    function refreshSummaryHumor() {
      const iframe = document.getElementById('summary-humor-preview');
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(generateDailySummaryHumorEmail(mockUser, mockWorkDataSummary, mockConfig));
      doc.close();
    }

    // åˆ·æ–°å·¥ä½œè­¦å‘Šå¹½é»˜ç‰ˆé¢„è§ˆ
    function refreshWarningHumor() {
      const iframe = document.getElementById('warning-humor-preview');
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(generateWarningHumorEmail(mockUser, mockWorkDataWarning, mockConfig));
      doc.close();
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–é¢„è§ˆ
    window.onload = function() {
      refreshSummary();
      refreshWarning();
      refreshSummaryHumor();
      refreshWarningHumor();
    };
  </script>
</body>
</html>