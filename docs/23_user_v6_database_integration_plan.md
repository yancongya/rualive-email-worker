# User V6 æ•°æ®åº“å¯¹æ¥æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¥æœŸ**: 2026-01-27
- **ç‰ˆæœ¬**: 1.2
- **çŠ¶æ€**: å®æ–½ä¸­
- **ç›®æ ‡**: å°† User V6 é¢„è§ˆç‰ˆå‡çº§ä¸ºå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ï¼Œå®ç°ä¸æ•°æ®åº“çš„å®æ—¶å¯¹æ¥

---

## å®æ–½è¿›åº¦ï¼ˆ2026-01-27 æ›´æ–°ï¼‰

### âœ… å·²å®Œæˆï¼ˆ40%ï¼‰

**Stage 1: æ•°æ®è·å–ä¸å±•ç¤ºï¼ˆå·²å®Œæˆï¼‰**
- âœ… å®ç° `workLogToProjectData()` æ•°æ®è½¬æ¢å‡½æ•°
- âœ… å®ç° `workLogToDailyData()` æ¯æ—¥æ•°æ®è½¬æ¢
- âœ… å®ç° `aggregateWorkLogsByDate()` æ—¥æœŸèšåˆ
- âœ… ä¿®å¤é¡¹ç›®åç§° URL ç¼–ç é—®é¢˜
- âœ… ä¿®å¤åˆæˆæ•°æ®æ ¼å¼ï¼ˆå¯¹è±¡è½¬å­—ç¬¦ä¸²æ•°ç»„ï¼‰
- âœ… ä¿®å¤å›¾å±‚æ•°æ®æ ¼å¼ï¼ˆåˆ†ç±»ç»Ÿè®¡ï¼‰
- âœ… ä¿®å¤å…³é”®å¸§æ•°æ®æ ¼å¼ï¼ˆæŒ‰å›¾å±‚èšåˆï¼‰
- âœ… ä¿®å¤ç‰¹æ•ˆæ•°æ®æ ¼å¼ï¼ˆæ·»åŠ  count å­—æ®µï¼‰
- âœ… ä¿®å¤è¿è¡Œæ—¶æ•°æ®æ ¼å¼ï¼ˆç´¯è®¡å·¥æ—¶ï¼‰
- âœ… ä¿®å¤æ—¥æœŸæ—¶åŒºé—®é¢˜ï¼ˆä½¿ç”¨æœ¬åœ°æ—¶åŒºï¼‰
- âœ… ä¿®å¤æ•°æ®å»é‡é—®é¢˜ï¼ˆåˆæˆã€å›¾å±‚ã€å…³é”®å¸§ã€ç‰¹æ•ˆï¼‰
- âœ… ç§»é™¤æ‰€æœ‰è°ƒè¯•æ—¥å¿—
- âœ… Dashboard è§†å›¾æ˜¾ç¤ºçœŸå®æ•°æ®
- âœ… æ•°æ®æŒä¹…åŒ–æ­£å¸¸å·¥ä½œ
- âœ… å®Œæˆæ—¥æœŸï¼š2026-01-27

**Stage 5: é”™è¯¯å¤„ç†ï¼ˆéƒ¨åˆ†å®Œæˆï¼‰**
- âœ… å¤„ç† URL ç¼–ç é¡¹ç›®åç§°
- âœ… å¤„ç†ç©º JSON æ•°æ®
- âœ… å¤„ç†æ•°æ®æ ¼å¼ä¸åŒ¹é…
- âœ… å¤„ç†æ•°æ®é‡å¤é—®é¢˜
- âœ… æ·»åŠ æ•°æ®éªŒè¯å’Œå®¹é”™
- â³ ç½‘ç»œé”™è¯¯å¤„ç†ï¼ˆå¾…å®Œå–„ï¼‰
- â³ ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤ºï¼ˆå¾…å®Œå–„ï¼‰

### ğŸ“ å®æ–½æ—¥å¿—

**2026-01-27 - ç‰¹æ•ˆæ•°æ®æ ¼å¼ä¿®å¤**
- **é—®é¢˜**: ç‰¹æ•ˆé¢æ¿æ˜¾ç¤º "368/45 ç‹¬ç«‹ç‰¹æ•ˆ"ï¼Œä½†åœ†ç¯ä¸æ˜¾ç¤º
- **åŸå› **: Worker åç«¯å¤„ç†ç‰¹æ•ˆæ•°æ®æ—¶ç¼ºå°‘ `count` å­—æ®µï¼Œå¯¼è‡´å‰ç«¯æ— æ³•æ­£ç¡®èšåˆ
- **ä¿®å¤**: åœ¨ `src/index.js` ä¸­ä¸ºæ¯ä¸ªç‰¹æ•ˆé¡¹æ·»åŠ  `count: 1` å­—æ®µ
- **å½±å“**: ç‰¹æ•ˆåœ†ç¯ç°åœ¨å¯ä»¥æ­£å¸¸æ˜¾ç¤º
- **ç›¸å…³æ–‡ä»¶**: `src/index.js:2519-2533`

**2026-01-27 - ç§»é™¤è°ƒè¯•æ—¥å¿—**
- **é—®é¢˜**: æ§åˆ¶å°è¾“å‡ºå¤§é‡é‡å¤çš„è°ƒè¯•æ—¥å¿—
- **åŸå› **: ä¹‹å‰ä¸ºäº†è°ƒè¯•æ·»åŠ çš„ `console.log` è¯­å¥æ²¡æœ‰æ¸…ç†
- **ä¿®å¤**: ç§»é™¤ `dataTransform.ts` ä¸­æ‰€æœ‰è°ƒè¯•æ—¥å¿—
- **å½±å“**: æ§åˆ¶å°è¾“å‡ºæ›´åŠ æ¸…çˆ½
- **ç›¸å…³æ–‡ä»¶**: `public/src/dataTransform.ts`

**2026-01-27 - æ—¥æœŸæ—¶åŒºä¿®å¤**
- **é—®é¢˜**: æ•°æ®ä¸Šä¼ åæ— æ³•æŒ‰æ—¥æœŸæŸ¥è¯¢
- **åŸå› **: AE æ‰©å±•æ²¡æœ‰å‘é€ `workDate`ï¼ŒWorker ä½¿ç”¨ UTC æ—¥æœŸ
- **ä¿®å¤**: åœ¨ AE æ‰©å±•çš„ `emailManager.js` ä¸­æ·»åŠ  `workDate` å­—æ®µï¼ˆæœ¬åœ°æ—¶åŒºï¼‰
- **å½±å“**: æ•°æ®å¯ä»¥æŒ‰æ­£ç¡®æ—¥æœŸæŸ¥è¯¢å’Œæ˜¾ç¤º
- **ç›¸å…³æ–‡ä»¶**: `js/emailManager.js`

**2026-01-27 - æ•°æ®å»é‡ä¿®å¤**
- **é—®é¢˜**: åˆæˆæ•°æ®é‡å¤æ˜¾ç¤ºï¼ˆ3ä»½ä¸€æ ·çš„æ•°æ®ï¼‰
- **åŸå› **: ç®€å•çš„ `concat()` å¯¼è‡´æ•°æ®é‡å¤
- **ä¿®å¤**: ä½¿ç”¨ Map å®ç°åŸºäº `project + '|' + name` çš„å»é‡
- **å½±å“**: æ•°æ®ä¸å†é‡å¤æ˜¾ç¤º
- **ç›¸å…³æ–‡ä»¶**: `src/index.js`, `public/src/dataTransform.ts`

**2026-01-27 - åˆæˆæ•°æ®æ ¼å¼ä¿®å¤**
- **é—®é¢˜**: åˆæˆåæ˜¾ç¤ºä¸ºå¯¹è±¡ `{project: "...", name: {...}}`
- **åŸå› **: `composition_scanner.jsx` è¿”å›å®Œæ•´å¯¹è±¡ï¼Œä½†å‰ç«¯æœŸæœ›å­—ç¬¦ä¸²æ•°ç»„
- **ä¿®å¤**: åœ¨ `emailManager.js` ä¸­æå–åˆæˆåç§°
- **å½±å“**: åˆæˆåæ­£å¸¸æ˜¾ç¤º
- **ç›¸å…³æ–‡ä»¶**: `js/emailManager.js`

### ğŸ”„ è¿›è¡Œä¸­ï¼ˆ60%ï¼‰

**Stage 2: Analytics è§†å›¾ï¼ˆè¿›è¡Œä¸­ï¼‰**
- â³ å®ç°æ—¥æœŸèŒƒå›´æŸ¥è¯¢ API
- â³ å®ç°æ•°æ®èšåˆé€»è¾‘
- â³ æ›´æ–° Analytics è§†å›¾æ•°æ®æº

**Stage 3: Settings è§†å›¾ï¼ˆæœªå¼€å§‹ï¼‰**
- â³ å®ç°ç”¨æˆ·é…ç½® API
- â³ å®ç°é…ç½®ä¿å­˜/åŠ è½½
- â³ æ›´æ–° Settings è§†å›¾

**Stage 4: ä¼˜åŒ–å¢å¼ºï¼ˆæœªå¼€å§‹ï¼‰**
- â³ æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨ã€æ‡’åŠ è½½ï¼‰
- â³ ç¼“å­˜ç­–ç•¥ï¼ˆIndexedDBï¼‰
- â³ å“åº”å¼è®¾è®¡ï¼ˆç§»åŠ¨ç«¯é€‚é…ï¼‰

---

## ä¸€ã€ç°çŠ¶åˆ†æ

### 1.1 User V6 å½“å‰çŠ¶æ€ï¼ˆé¢„è§ˆç‰ˆæœ¬ï¼‰

**æ•°æ®æ¥æºï¼š**
- ä½¿ç”¨ `MOCK_DATA` å¯¹è±¡å­˜å‚¨æ¨¡æ‹Ÿæ•°æ®
- ä½¿ç”¨ `generateDynamicProject()` å‡½æ•°åŠ¨æ€ç”Ÿæˆé¡¹ç›®æ•°æ®
- æ‰€æœ‰æ•°æ®éƒ½æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä¸è¿æ¥çœŸå®æ•°æ®åº“

**æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š**
```typescript
interface ProjectData {
  projectId: string;
  name: string;
  dailyRuntime: string;
  accumulatedRuntime: number;
  statistics: {
    compositions: number;
    layers: number;
    keyframes: number;
    effects: number;
  };
  details: {
    compositions: string[];
    layers: LayerDistribution;
    keyframes: KeyframeData;
    effectCounts: EffectCountData;
  };
}
```

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- âœ… å®Œæ•´çš„ UI å±•ç¤ºï¼ˆDashboard/Analytics/Settings ä¸‰ä¸ªè§†å›¾ï¼‰
- âœ… æ—¥å†é€‰æ‹©å™¨
- âœ… æ•°æ®å¯è§†åŒ–ï¼ˆé›·è¾¾å›¾ã€é¥¼å›¾ã€è¶‹åŠ¿å›¾ï¼‰
- âœ… é¡¹ç›®æœç´¢å’Œè¿‡æ»¤
- âœ… åŒè¯­æ”¯æŒï¼ˆä¸­æ–‡/è‹±æ–‡ï¼‰
- âŒ æ— çœŸå®æ•°æ®è¿æ¥
- âŒ æ— ç”¨æˆ·é…ç½®åŠŸèƒ½
- âŒ æ— å®æ—¶æ›´æ–°

### 1.2 User ç‰ˆæœ¬å½“å‰çŠ¶æ€ï¼ˆå®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ï¼‰

**æ•°æ®æ¥æºï¼š**
- é€šè¿‡ API è°ƒç”¨ `/api/work-logs` è·å–çœŸå®å·¥ä½œæ—¥å¿—
- é€šè¿‡ API è°ƒç”¨ `/api/config` è·å–ç”¨æˆ·é…ç½®
- æ•°æ®å­˜å‚¨åœ¨ Cloudflare D1 æ•°æ®åº“ä¸­

**ä½¿ç”¨çš„ API ç«¯ç‚¹ï¼š**
```javascript
- GET /api/work-logs - è·å–å·¥ä½œæ—¥å¿—
- GET /api/config - è·å–ç”¨æˆ·é…ç½®
- POST /api/config - ä¿å­˜ç”¨æˆ·é…ç½®
- POST /api/send-now - å‘é€æµ‹è¯•é‚®ä»¶
- POST /api/heartbeat - å‘é€å¿ƒè·³
- GET /api/ae-status - è·å– AE çŠ¶æ€
- POST /api/ae-status - æ›´æ–° AE çŠ¶æ€
```

**æ•°æ®åº“è¡¨ç»“æ„ï¼š**
```sql
work_logs è¡¨å­—æ®µï¼š
- id, user_id, work_date
- work_hours, keyframe_count, json_size
- project_count, composition_count, layer_count, effect_count
- compositions_json, effects_json, layers_json, keyframes_json
- projects_json, work_hours_json

user_configs è¡¨å­—æ®µï¼š
- enabled, email_address, daily_report_time
- emergency_email, min_work_hours, min_keyframes
- user_notification_time, emergency_notification_time
- notification_schedule, notification_excluded_days
```

**åŠŸèƒ½ç‰¹ç‚¹ï¼š**
- âœ… çœŸå®æ•°æ®å±•ç¤º
- âœ… ç”¨æˆ·é…ç½®ç®¡ç†
- âœ… é‚®ä»¶é€šçŸ¥é…ç½®
- âœ… AE åœ¨çº¿çŠ¶æ€ç›‘æ§
- âœ… å®æ—¶æ•°æ®æ›´æ–°
- âœ… å¿ƒè·³æœºåˆ¶
- âŒ UI ç›¸å¯¹ç®€å•ï¼ˆä½¿ç”¨ä¼ ç»Ÿ HTML/CSSï¼‰

---

## äºŒã€æ•°æ®æ ¼å¼å¯¹æ¯”åˆ†æ

### 2.1 æ•°æ®æ¥æºå¯¹æ¯”

| æ•°æ®é¡¹ | User V6ï¼ˆæ¨¡æ‹Ÿï¼‰ | Userï¼ˆçœŸå®ï¼‰ | æ•°æ®åº“å­—æ®µ |
|--------|----------------|--------------|------------|
| åˆæˆæ•°é‡ | `project.statistics.compositions` | `work_logs.composition_count` | composition_count |
| å›¾å±‚æ•°é‡ | `project.statistics.layers` | `work_logs.layer_count` | layer_count |
| å…³é”®å¸§æ•°é‡ | `project.statistics.keyframes` | `work_logs.keyframe_count` | keyframe_count |
| ç‰¹æ•ˆæ•°é‡ | `project.statistics.effects` | `work_logs.effect_count` | effect_count |
| è¿è¡Œæ—¶é•¿ | `project.accumulatedRuntime` | `work_logs.work_hours` | work_hours |
| é¡¹ç›®åç§° | `project.name` | JSON è§£æ | projects_json |
| åˆæˆåˆ—è¡¨ | `project.details.compositions` | JSON è§£æ | compositions_json |
| å›¾å±‚åˆ†å¸ƒ | `project.details.layers` | JSON è§£æ | layers_json |
| å…³é”®å¸§è¯¦æƒ… | `project.details.keyframes` | JSON è§£æ | keyframes_json |
| ç‰¹æ•ˆç»Ÿè®¡ | `project.details.effectCounts` | JSON è§£æ | effects_json |

### 2.2 æ•°æ®æ ¼å¼å·®å¼‚

**User V6 æ ¼å¼ï¼š**
```typescript
layers: {
  video: 10,
  image: 80,
  designFile: 120,
  sourceFile: 5,
  nullSolidLayer: 20
}
```

**æ•°æ®åº“ JSON æ ¼å¼ï¼š**
```json
[
  {"project": "Project1.aep", "name": "Video Layer 1"},
  {"project": "Project1.aep", "name": "Image Layer 1"}
]
```

**è½¬æ¢éœ€æ±‚ï¼š**
- æ•°æ®åº“æ ¼å¼éœ€è¦èšåˆæˆ User V6 çš„åˆ†ç±»æ ¼å¼
- éœ€è¦æ ¹æ®å›¾å±‚åç§°å‰ç¼€æˆ–å…³é”®è¯è¿›è¡Œåˆ†ç±»

---

## ä¸‰ã€å®æ–½æ­¥éª¤

### é˜¶æ®µ 1ï¼šæ•°æ®è·å–å±‚æ”¹é€ ï¼ˆåŸºç¡€æ•°æ®ï¼‰

**ç›®æ ‡ï¼š** å°†æ¨¡æ‹Ÿæ•°æ®æ›¿æ¢ä¸ºçœŸå® API æ•°æ®

**æ­¥éª¤ï¼š**

1. **åˆ›å»º API æœåŠ¡æ¨¡å—**
   - åˆ›å»º `src/api.ts` æ–‡ä»¶
   - å®ç°è®¤è¯å‡½æ•°ï¼ˆä» localStorage è·å– tokenï¼‰
   - å®ç°æ•°æ®è·å–å‡½æ•°

2. **å®ç°åŸºç¡€æ•°æ®è·å–**
   ```typescript
   // src/api.ts
   export async function getWorkLogs(date?: string): Promise<WorkLogResponse> {
     const token = localStorage.getItem('rualive_token');
     const url = date 
       ? `/api/work-logs?date=${date}`
       : '/api/work-logs';
     
     const response = await fetch(url, {
       headers: { 'Authorization': `Bearer ${token}` }
     });
     
     return response.json();
   }
   ```

3. **æ•°æ®æ ¼å¼è½¬æ¢**
   - åˆ›å»º `src/dataTransform.ts` æ–‡ä»¶
   - å®ç° `workLogToProjectData()` è½¬æ¢å‡½æ•°
   - å°†æ•°æ®åº“ JSON æ ¼å¼è½¬æ¢ä¸º User V6 çš„ TypeScript æ¥å£

4. **æ›¿æ¢ mock æ•°æ®**
   - åœ¨ `user-v6.tsx` ä¸­å¯¼å…¥çœŸå® API
   - æ›¿æ¢ `dailyData` çš„ useMemo é€»è¾‘
   - ä½¿ç”¨ useEffect è¿›è¡Œåˆå§‹æ•°æ®åŠ è½½

**é¢„æœŸç»“æœï¼š**
- âœ… Dashboard è§†å›¾æ˜¾ç¤ºçœŸå®æ•°æ®
- âœ… æ—¥å†é€‰æ‹©å™¨åŠ è½½å¯¹åº”æ—¥æœŸæ•°æ®
- âš ï¸ Analytics è§†å›¾ä»ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¾…é˜¶æ®µ 2ï¼‰

**æ—¶é—´ä¼°ç®—ï¼š** 2-3 å¤©

---

### é˜¶æ®µ 2ï¼šAnalytics æ•°æ®å¯¹æ¥ï¼ˆè¶‹åŠ¿åˆ†æï¼‰

**ç›®æ ‡ï¼š** å®ç° Analytics è§†å›¾çš„çœŸå®æ•°æ®å±•ç¤º

**æ­¥éª¤ï¼š**

1. **å®ç°æ—¥æœŸèŒƒå›´æ•°æ®è·å–**
   ```typescript
   export async function getWorkLogsByDateRange(
     startDate: string, 
     endDate: string
   ): Promise<WorkLogResponse> {
     // éœ€è¦åç«¯æ”¯æŒæ—¥æœŸèŒƒå›´æŸ¥è¯¢
     // æˆ–è€…å‰ç«¯å¤šæ¬¡è°ƒç”¨ååˆå¹¶
   }
   ```

2. **åç«¯ API å¢å¼º**
   - åœ¨ `src/index.js` ä¸­æ·»åŠ æ—¥æœŸèŒƒå›´æŸ¥è¯¢æ”¯æŒ
   - æ–°å¢ `/api/work-logs/range` ç«¯ç‚¹
   - æ”¯æŒ `start_date` å’Œ `end_date` å‚æ•°

3. **æ•°æ®èšåˆé€»è¾‘**
   - å®ç° `aggregateAnalyticsData()` å‡½æ•°
   - æŒ‰å‘¨/æœˆ/å­£/å¹´èšåˆæ•°æ®
   - è®¡ç®—ç»Ÿè®¡æŒ‡æ ‡ï¼ˆæ€»å’Œã€å¹³å‡å€¼ã€æœ€å¤§å€¼ï¼‰

4. **æ›¿æ¢ Analytics æ•°æ®**
   - æ›´æ–° `AnalyticsView` ç»„ä»¶
   - ä½¿ç”¨çœŸå®æ•°æ®æ›¿æ¢ `getAnalyticsData()` å‡½æ•°
   - ä¿æŒç°æœ‰çš„å›¾è¡¨å’Œè¡¨æ ¼å±•ç¤ºé€»è¾‘

**é¢„æœŸç»“æœï¼š**
- âœ… Analytics è§†å›¾æ˜¾ç¤ºçœŸå®è¶‹åŠ¿æ•°æ®
- âœ… æ”¯æŒå‘¨/æœˆ/å­£/å¹´è§†å›¾åˆ‡æ¢
- âœ… å›¾è¡¨å’Œè¡¨æ ¼æ•°æ®å‡†ç¡®

**æ—¶é—´ä¼°ç®—ï¼š** 2-3 å¤©

---

### é˜¶æ®µ 3ï¼šç”¨æˆ·é…ç½®åŠŸèƒ½ï¼ˆSettings è§†å›¾ï¼‰

**ç›®æ ‡ï¼š** å®ç° Settings è§†å›¾çš„çœŸå®é…ç½®åŠŸèƒ½

**æ­¥éª¤ï¼š**

1. **å®ç°é…ç½® API**
   ```typescript
   export async function getUserConfig(): Promise<UserConfig> {
     const token = localStorage.getItem('rualive_token');
     const response = await fetch('/api/config', {
       headers: { 'Authorization': `Bearer ${token}` }
     });
     return response.json();
   }
   
   export async function saveUserConfig(config: UserConfig): Promise<void> {
     const token = localStorage.getItem('rualive_token');
     await fetch('/api/config', {
       method: 'POST',
       headers: { 
         'Authorization': `Bearer ${token}`,
         'Content-Type': 'application/json'
       },
       body: JSON.stringify(config)
     });
   }
   ```

2. **Settings ç»„ä»¶æ”¹é€ **
   - æ›¿æ¢æ¨¡æ‹Ÿé…ç½®ä¸ºçœŸå® API
   - å®ç°ä¿å­˜åŠŸèƒ½
   - æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

3. **é…ç½®è¡¨å•å¢å¼º**
   - æ·»åŠ é‚®ä»¶é€šçŸ¥é…ç½®
   - æ·»åŠ ç´§æ€¥è”ç³»äººé…ç½®
   - æ·»åŠ å·¥ä½œæ—¶é—´é˜ˆå€¼é…ç½®

**é¢„æœŸç»“æœï¼š**
- âœ… Settings è§†å›¾æ˜¾ç¤ºçœŸå®ç”¨æˆ·é…ç½®
- âœ… å¯ä»¥ä¿å­˜å’Œä¿®æ”¹é…ç½®
- âœ… é…ç½®å˜æ›´å³æ—¶ç”Ÿæ•ˆ

**æ—¶é—´ä¼°ç®—ï¼š** 1-2 å¤©

---

### é˜¶æ®µ 4ï¼šå®æ—¶æ›´æ–°åŠŸèƒ½

**ç›®æ ‡ï¼š** å®ç°æ•°æ®çš„å®æ—¶æ›´æ–°

**æ­¥éª¤ï¼š**

1. **å¿ƒè·³æœºåˆ¶**
   - å®šæœŸå‘é€å¿ƒè·³è¯·æ±‚ï¼ˆæ¯ 30 ç§’ï¼‰
   - æ£€æµ‹ AE åœ¨çº¿çŠ¶æ€
   - æ›´æ–° UI çŠ¶æ€æŒ‡ç¤ºå™¨

2. **è‡ªåŠ¨åˆ·æ–°**
   - å®ç° `useRealtimeData` Hook
   - ä½¿ç”¨å®šæ—¶å™¨å®šæœŸåˆ·æ–°æ•°æ®
   - ç”¨æˆ·å¯é€‰æ‹©è‡ªåŠ¨åˆ·æ–°é—´éš”

3. **WebSocketï¼ˆå¯é€‰ï¼‰**
   - è€ƒè™‘ä½¿ç”¨ WebSocket å®ç°æ¨é€
   - å®æ—¶é€šçŸ¥æ–°æ•°æ®
   - å‡å°‘è½®è¯¢å¼€é”€

**é¢„æœŸç»“æœï¼š**
- âœ… æ•°æ®è‡ªåŠ¨æ›´æ–°
- âœ… AE çŠ¶æ€å®æ—¶ç›‘æ§
- âœ… æ–°æ•°æ®å³æ—¶å±•ç¤º

**æ—¶é—´ä¼°ç®—ï¼š** 2-3 å¤©

---

### é˜¶æ®µ 5ï¼šé”™è¯¯å¤„ç†å’Œä¼˜åŒ–

**ç›®æ ‡ï¼š** å®Œå–„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ä¼˜åŒ–

**æ­¥éª¤ï¼š**

1. **é”™è¯¯å¤„ç†**
   - æ·»åŠ  API é”™è¯¯å¤„ç†
   - æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
   - å®ç°é‡è¯•æœºåˆ¶

2. **åŠ è½½çŠ¶æ€**
   - æ·»åŠ éª¨æ¶å±åŠ è½½æ•ˆæœ
   - ä¼˜åŒ–åŠ è½½ä½“éªŒ
   - å¤„ç†ç©ºæ•°æ®çŠ¶æ€

3. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°æ•°æ®ç¼“å­˜
   - ä½¿ç”¨ React.memo ä¼˜åŒ–æ¸²æŸ“
   - æ·»åŠ è™šæ‹Ÿæ»šåŠ¨ï¼ˆé•¿åˆ—è¡¨ï¼‰

4. **æ•°æ®éªŒè¯**
   - æ·»åŠ æ•°æ®æ ¼å¼éªŒè¯
   - å¤„ç†å¼‚å¸¸æ•°æ®
   - æä¾›é»˜è®¤å€¼

**é¢„æœŸç»“æœï¼š**
- âœ… ç¨³å®šçš„æ•°æ®åŠ è½½
- âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ
- âœ… ä¼˜ç§€çš„æ€§èƒ½è¡¨ç°

**æ—¶é—´ä¼°ç®—ï¼š** 1-2 å¤©

---

## å››ã€å…³é”®æŠ€æœ¯ç‚¹

### 4.1 æ•°æ®æ ¼å¼è½¬æ¢

**æŒ‘æˆ˜ï¼š** æ•°æ®åº“ JSON æ ¼å¼ä¸ User V6 æ ¼å¼ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆï¼š**
```typescript
function transformWorkLogToProjectData(workLog: WorkLog): ProjectData[] {
  const projectsJson = JSON.parse(workLog.projects_json || '[]');
  const compositionsJson = JSON.parse(workLog.compositions_json || '[]');
  const layersJson = JSON.parse(workLog.layers_json || '[]');
  const keyframesJson = JSON.parse(workLog.keyframes_json || '[]');
  const effectsJson = JSON.parse(workLog.effects_json || '[]');
  
  // æŒ‰é¡¹ç›®åˆ†ç»„æ•°æ®
  const projectMap = new Map<string, ProjectData>();
  
  // åˆå§‹åŒ–é¡¹ç›®
  projectsJson.forEach((p: any) => {
    projectMap.set(p.name, {
      projectId: p.id || generateId(p.name),
      name: p.name,
      dailyRuntime: formatRuntime(workLog.work_hours),
      accumulatedRuntime: workLog.work_hours * 3600,
      statistics: {
        compositions: 0,
        layers: 0,
        keyframes: 0,
        effects: 0
      },
      details: {
        compositions: [],
        layers: { video: 0, image: 0, designFile: 0, sourceFile: 0, nullSolidLayer: 0 },
        keyframes: {},
        effectCounts: {}
      }
    });
  });
  
  // å¡«å……åˆæˆæ•°æ®
  compositionsJson.forEach((c: any) => {
    const project = projectMap.get(c.project);
    if (project) {
      project.details.compositions.push(c.name);
      project.statistics.compositions++;
    }
  });
  
  // å¡«å……å›¾å±‚æ•°æ®ï¼ˆéœ€è¦åˆ†ç±»ï¼‰
  layersJson.forEach((l: any) => {
    const project = projectMap.get(l.project);
    if (project) {
      const layerType = classifyLayer(l.name);
      project.details.layers[layerType]++;
      project.statistics.layers++;
    }
  });
  
  // å¡«å……å…³é”®å¸§æ•°æ®
  keyframesJson.forEach((k: any) => {
    const project = projectMap.get(k.project);
    if (project) {
      project.details.keyframes[k.layer] = k.count;
      project.statistics.keyframes += k.count;
    }
  });
  
  // å¡«å……ç‰¹æ•ˆæ•°æ®
  effectsJson.forEach((e: any) => {
    const project = projectMap.get(e.project);
    if (project) {
      project.details.effectCounts[e.name] = (project.details.effectCounts[e.name] || 0) + e.count;
      project.statistics.effects++;
    }
  });
  
  return Array.from(projectMap.values());
}

function classifyLayer(layerName: string): keyof LayerDistribution {
  const name = layerName.toLowerCase();
  if (name.includes('video') || name.includes('mov') || name.includes('mp4')) {
    return 'video';
  } else if (name.includes('image') || name.includes('jpg') || name.includes('png')) {
    return 'image';
  } else if (name.includes('design') || name.includes('psd') || name.includes('ai')) {
    return 'designFile';
  } else if (name.includes('null') || name.includes('solid')) {
    return 'nullSolidLayer';
  } else {
    return 'sourceFile';
  }
}
```

### 4.2 åç«¯ API å¢å¼º

**éœ€è¦æ–°å¢çš„ API ç«¯ç‚¹ï¼š**

```javascript
// src/index.js

// è·å–æ—¥æœŸèŒƒå›´çš„å·¥ä½œæ—¥å¿—
if (path === '/api/work-logs/range' && request.method === 'GET') {
  return handleGetWorkLogsRange(request, env);
}

async function handleGetWorkLogsRange(request, env) {
  const payload = await verifyAuth(request, env);
  if (!payload) {
    return Response.json({ error: 'æœªæˆæƒ' }, { status: 401 });
  }

  const userId = payload.userId;
  const url = new URL(request.url);
  const startDate = url.searchParams.get('start_date');
  const endDate = url.searchParams.get('end_date');
  
  const result = await DB.prepare(`
    SELECT * FROM work_logs 
    WHERE user_id = ? 
    AND work_date BETWEEN ? AND ?
    ORDER BY work_date DESC
  `).bind(userId, startDate, endDate).all();
  
  return Response.json({ success: true, data: result.results || [] });
}
```

### 4.3 ç¼“å­˜ç­–ç•¥

```typescript
class DataCache {
  private cache = new Map<string, { data: any, timestamp: number }>();
  private TTL = 5 * 60 * 1000; // 5åˆ†é’Ÿ

  set(key: string, data: any) {
    this.cache.set(key, { data, timestamp: Date.now() });
  }

  get(key: string): any | null {
    const item = this.cache.get(key);
    if (!item) return null;
    
    if (Date.now() - item.timestamp > this.TTL) {
      this.cache.delete(key);
      return null;
    }
    
    return item.data;
  }

  clear() {
    this.cache.clear();
  }
}

export const dataCache = new DataCache();
```

---

## äº”ã€å®æ–½ä¼˜å…ˆçº§å’Œæ—¶é—´ä¼°ç®—

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **é˜¶æ®µ 1ï¼šåŸºç¡€æ•°æ®å¯¹æ¥** - 2-3 å¤©
   - åˆ›å»º API æœåŠ¡æ¨¡å—
   - å®ç°æ•°æ®æ ¼å¼è½¬æ¢
   - Dashboard è§†å›¾çœŸå®æ•°æ®å±•ç¤º

2. **é˜¶æ®µ 2ï¼šAnalytics æ•°æ®å¯¹æ¥** - 2-3 å¤©
   - åç«¯ API å¢å¼º
   - æ•°æ®èšåˆé€»è¾‘
   - Analytics è§†å›¾çœŸå®æ•°æ®å±•ç¤º

### ä¸­ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å®Œå–„ï¼‰

3. **é˜¶æ®µ 3ï¼šç”¨æˆ·é…ç½®åŠŸèƒ½** - 1-2 å¤©
   - Settings è§†å›¾çœŸå®é…ç½®
   - é…ç½®ä¿å­˜åŠŸèƒ½

4. **é˜¶æ®µ 5ï¼šé”™è¯¯å¤„ç†å’Œä¼˜åŒ–** - 1-2 å¤©
   - é”™è¯¯å¤„ç†æœºåˆ¶
   - åŠ è½½çŠ¶æ€ä¼˜åŒ–

### ä½ä¼˜å…ˆçº§ï¼ˆå¢å¼ºåŠŸèƒ½ï¼‰

5. **é˜¶æ®µ 4ï¼šå®æ—¶æ›´æ–°åŠŸèƒ½** - 2-3 å¤©
   - å¿ƒè·³æœºåˆ¶
   - è‡ªåŠ¨åˆ·æ–°
   - WebSocketï¼ˆå¯é€‰ï¼‰

**æ€»å·¥æ—¶ä¼°ç®—ï¼š** 8-13 å¤©

---

## å…­ã€é£é™©è¯„ä¼°å’Œå»ºè®®

### 6.1 é£é™©ç‚¹

#### 1. æ•°æ®æ ¼å¼ä¸åŒ¹é…

- **é£é™©ï¼š** æ•°æ®åº“ JSON æ ¼å¼ä¸ User V6 æ ¼å¼å·®å¼‚è¾ƒå¤§
- **å½±å“ï¼š** æ•°æ®è½¬æ¢é€»è¾‘å¤æ‚ï¼Œå¯èƒ½ä¸¢å¤±éƒ¨åˆ†ä¿¡æ¯
- **å»ºè®®ï¼š** è¯¦ç»†æµ‹è¯•æ•°æ®è½¬æ¢ï¼Œè¡¥å……åˆ†ç±»è§„åˆ™

#### 2. æ€§èƒ½é—®é¢˜

- **é£é™©ï¼š** å¤§é‡æ•°æ®åŠ è½½å’Œæ¸²æŸ“å¯èƒ½å½±å“æ€§èƒ½
- **å½±å“ï¼š** é¡µé¢å¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒå·®
- **å»ºè®®ï¼š** å®ç°åˆ†é¡µã€è™šæ‹Ÿæ»šåŠ¨ã€æ•°æ®ç¼“å­˜

#### 3. å‘åå…¼å®¹æ€§

- **é£é™©ï¼š** User ç‰ˆæœ¬å¯èƒ½éœ€è¦ç»§ç»­ç»´æŠ¤
- **å½±å“ï¼š** ç»´æŠ¤æˆæœ¬å¢åŠ 
- **å»ºè®®ï¼š** è€ƒè™‘é€æ­¥è¿ç§»ï¼Œç»Ÿä¸€ä»£ç åº“

### 6.2 å»ºè®®

#### 1. ä¿æŒä¸¤ä¸ªç‰ˆæœ¬å¹¶è¡Œ

- **User ç‰ˆæœ¬ï¼š** ç¨³å®šç‰ˆï¼Œç”¨äºç”Ÿäº§ç¯å¢ƒ
- **User V6ï¼š** é¢„è§ˆç‰ˆï¼Œç”¨äºæµ‹è¯•å’Œè¿­ä»£

#### 2. æ¸è¿›å¼è¿ç§»

- å…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½
- é€æ­¥æ·»åŠ å¢å¼ºåŠŸèƒ½
- æ”¶é›†ç”¨æˆ·åé¦ˆ

#### 3. å……åˆ†çš„æµ‹è¯•

- å•å…ƒæµ‹è¯•ï¼šæ•°æ®è½¬æ¢é€»è¾‘
- é›†æˆæµ‹è¯•ï¼šAPI è°ƒç”¨
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šå®Œæ•´æµç¨‹

#### 4. æ–‡æ¡£å®Œå–„

- API æ–‡æ¡£
- æ•°æ®æ ¼å¼æ–‡æ¡£
- è¿ç§»æŒ‡å—

---

## ä¸ƒã€æ–‡ä»¶ç»“æ„è§„åˆ’

### æ–°å¢æ–‡ä»¶

```
public/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api.ts              # API æœåŠ¡æ¨¡å—
â”‚   â”œâ”€â”€ dataTransform.ts    # æ•°æ®æ ¼å¼è½¬æ¢
â”‚   â”œâ”€â”€ cache.ts            # ç¼“å­˜ç®¡ç†
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.ts      # è®¤è¯ Hook
â”‚   â”‚   â”œâ”€â”€ useWorkLogs.ts  # å·¥ä½œæ—¥å¿— Hook
â”‚   â”‚   â””â”€â”€ useRealtimeData.ts  # å®æ—¶æ•°æ® Hook
â”‚   â””â”€â”€ types/
â”‚       â”œâ”€â”€ api.ts          # API ç±»å‹å®šä¹‰
â”‚       â””â”€â”€ database.ts     # æ•°æ®åº“ç±»å‹å®šä¹‰
```

### ä¿®æ”¹æ–‡ä»¶

```
public/
â”œâ”€â”€ user-v6.tsx             # ä¸»åº”ç”¨ç»„ä»¶
â”œâ”€â”€ user-v6-settings.tsx    # Settings ç»„ä»¶
â””â”€â”€ vite.config.ts          # Vite é…ç½®ï¼ˆå¯èƒ½éœ€è¦è°ƒæ•´ï¼‰
```

### åç«¯æ–‡ä»¶

```
src/
â””â”€â”€ index.js                # æ·»åŠ æ–°çš„ API ç«¯ç‚¹
```

---

## å…«ã€æµ‹è¯•è®¡åˆ’

### 8.1 å•å…ƒæµ‹è¯•

- æ•°æ®æ ¼å¼è½¬æ¢å‡½æ•°
- å›¾å±‚åˆ†ç±»é€»è¾‘
- æ•°æ®èšåˆå‡½æ•°
- ç¼“å­˜ç®¡ç†

### 8.2 é›†æˆæµ‹è¯•

- API è°ƒç”¨æµ‹è¯•
- è®¤è¯æµç¨‹æµ‹è¯•
- æ•°æ®åŠ è½½æµ‹è¯•
- é”™è¯¯å¤„ç†æµ‹è¯•

### 8.3 ç«¯åˆ°ç«¯æµ‹è¯•

- å®Œæ•´ç”¨æˆ·æµç¨‹
- Dashboard è§†å›¾
- Analytics è§†å›¾
- Settings è§†å›¾

---

## ä¹ã€æ€»ç»“

User V6 æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§ã€UI ç²¾ç¾çš„é¢„è§ˆç‰ˆæœ¬ï¼Œè¦å®ç°ä¸æ•°æ®åº“çš„å®æ—¶å¯¹æ¥ï¼Œéœ€è¦ï¼š

1. **æ›¿æ¢æ¨¡æ‹Ÿæ•°æ®**ï¼šä» MOCK_DATA è½¬ä¸ºçœŸå® API è°ƒç”¨
2. **æ•°æ®æ ¼å¼è½¬æ¢**ï¼šå°†æ•°æ®åº“ JSON æ ¼å¼è½¬æ¢ä¸º User V6 çš„ TypeScript æ¥å£
3. **åç«¯ API å¢å¼º**ï¼šæ·»åŠ æ—¥æœŸèŒƒå›´æŸ¥è¯¢ç­‰æ–°åŠŸèƒ½
4. **é€æ­¥å®ç°**ï¼šæŒ‰ç…§é˜¶æ®µ 1-5 çš„é¡ºåºé€æ­¥å®æ–½
5. **å……åˆ†æµ‹è¯•**ï¼šç¡®ä¿æ•°æ®å‡†ç¡®æ€§å’Œç³»ç»Ÿç¨³å®šæ€§

**é¢„è®¡æ€»å·¥æ—¶ï¼š** 8-13 å¤©ï¼ˆæ ¹æ®åŠŸèƒ½ä¼˜å…ˆçº§è°ƒæ•´ï¼‰

**å»ºè®®é‡‡ç”¨æ¸è¿›å¼å¼€å‘**ï¼Œå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†é€æ­¥å®Œå–„å¢å¼ºåŠŸèƒ½ï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µéƒ½èƒ½äº§å‡ºå¯ç”¨çš„ç‰ˆæœ¬ã€‚

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£

- [User V6 é›†æˆå’Œä¿®å¤æ–‡æ¡£](./22_user_v6_integration_and_fixes.md)
- [æ•°æ®åº“æ¶æ„è®¾è®¡](../schema.sql)
- [API æ–‡æ¡£](../README.md)

### B. è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²ï¼š**

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|----------|
| 1.0 | 2026-01-27 | iFlow CLI | åˆå§‹ç‰ˆæœ¬ |