<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuAlive æ•°æ®æµç¨‹è¯´æ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 50px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section h2 .icon {
            font-size: 1.2em;
        }

        .step {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-left: 3px solid #764ba2;
        }

        .step h3 {
            color: #764ba2;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        .code-block .comment {
            color: #888;
            font-style: italic;
        }

        .code-block .keyword {
            color: #ff79c6;
        }

        .code-block .string {
            color: #f1fa8c;
        }

        .code-block .property {
            color: #8be9fd;
        }

        .flow-diagram {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .flow-step {
            text-align: center;
            flex: 1;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            margin: 0 10px;
            position: relative;
        }

        .flow-step .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .flow-step .label {
            font-weight: bold;
            font-size: 0.9em;
        }

        .flow-arrow {
            font-size: 2em;
            color: #667eea;
            flex-shrink: 0;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table tr:hover {
            background: #f5f5f5;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .highlight {
            background: #fff3cd;
            padding: 2px 5px;
            border-radius: 3px;
            font-weight: bold;
        }

        .note {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .note .note-title {
            font-weight: bold;
            color: #155724;
            margin-bottom: 5px;
        }

        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .warning .warning-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 5px;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .flow-diagram {
                flex-direction: column;
            }

            .flow-arrow {
                transform: rotate(90deg);
                margin: 10px 0;
            }

            .flow-step {
                width: 100%;
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”„ RuAlive æ•°æ®æµç¨‹è¯´æ˜</h1>
            <p>ä» AE æ‰©å±•åˆ°å‰ç«¯çš„å®Œæ•´æ•°æ®æµè½¬è¿‡ç¨‹</p>
        </div>

        <div class="content">
            <!-- æµç¨‹æ¦‚è§ˆ -->
            <div class="section">
                <h2><span class="icon">ğŸ“Š</span> æ•°æ®æµç¨‹æ¦‚è§ˆ</h2>
                <div class="flow-diagram">
                    <div class="flow-step">
                        <div class="icon">ğŸ¨</div>
                        <div class="label">AE æ‰©å±•</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">æ‰«æé¡¹ç›®</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="icon">ğŸ“</div>
                        <div class="label">JSON æ–‡ä»¶</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">æœ¬åœ°å­˜å‚¨</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="icon">â˜ï¸</div>
                        <div class="label">Cloudflare Worker</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">API æ¥æ”¶</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="icon">ğŸ—„ï¸</div>
                        <div class="label">D1 æ•°æ®åº“</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">æ•°æ®å­˜å‚¨</div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="icon">ğŸ’¾</div>
                        <div class="label">KV å­˜å‚¨</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">å‰ç«¯ä»£ç </div>
                    </div>
                    <div class="flow-arrow">â†’</div>
                    <div class="flow-step">
                        <div class="icon">ğŸ–¥ï¸</div>
                        <div class="label">ç”¨æˆ·é¢æ¿</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">æ•°æ®å±•ç¤º</div>
                    </div>
                </div>
            </div>

            <!-- ç¬¬ä¸€æ­¥ï¼šAE æ‰©å±•ç”Ÿæˆ JSON -->
            <div class="section">
                <h2><span class="icon">1ï¸âƒ£</span> ç¬¬ä¸€æ­¥ï¼šAE æ‰©å±•ç”Ÿæˆ JSON æ•°æ®</h2>
                <div class="step">
                    <h3>1.1 æ‰«æ AE é¡¹ç›®</h3>
                    <p>AE æ‰©å±•é€šè¿‡ JSX è„šæœ¬æ‰«æå½“å‰æ‰“å¼€çš„ After Effects é¡¹ç›®ï¼Œæ”¶é›†ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>é¡¹ç›®åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€è·¯å¾„ã€åˆ›å»ºæ—¶é—´ç­‰ï¼‰</li>
                        <li>åˆæˆåˆ—è¡¨ï¼ˆcompositionsï¼‰</li>
                        <li>å›¾å±‚åˆ—è¡¨ï¼ˆlayersï¼‰</li>
                        <li>å…³é”®å¸§æ•°é‡ï¼ˆkeyframesï¼‰</li>
                        <li>æ•ˆæœåˆ—è¡¨ï¼ˆeffectsï¼‰</li>
                        <li>å·¥ä½œæ—¶é•¿ï¼ˆaccumulatedRuntimeï¼‰</li>
                    </ul>
                </div>

                <div class="step">
                    <h3>1.2 ç”Ÿæˆ JSON æ–‡ä»¶</h3>
                    <p>æ‰«æå®Œæˆåï¼Œæ‰©å±•å°†æ•°æ®ä¿å­˜ä¸º JSON æ–‡ä»¶ï¼Œæ–‡ä»¶åæ ¼å¼ï¼š<span class="highlight">YYYY-MM-DD-é¡¹ç›®å-hash.json</span></p>
                    <div class="code-block">
<span class="comment">// æ–‡ä»¶ä½ç½®ï¼šC:\Users\ç”¨æˆ·å\Documents\RuAlive@çƒŸå›±é¸­\</span>
<span class="comment">// ç¤ºä¾‹æ–‡ä»¶åï¼š2026-01-19-52000é’»-ç‚½æ‹å¼¦æ­Œ-240c62c4.json</span>

{
  <span class="property">"projectId"</span>: <span class="string">"240c62c4"</span>,
  <span class="property">"name"</span>: <span class="string">"52000é’»-ç‚½æ‹å¼¦æ­Œ.aep"</span>,
  <span class="property">"path"</span>: <span class="string">"E:\\å·¥ä½œ\\2026\\202601\\52000é’»-ç‚½æ‹å¼¦æ­Œ.aep"</span>,
  <span class="property">"createTime"</span>: <span class="string">"2026-01-19 09:47:22"</span>,
  <span class="property">"dailyRuntime"</span>: <span class="string">"5å°æ—¶9åˆ†46ç§’"</span>,
  <span class="property">"accumulatedRuntime"</span>: <span class="number">18586</span>,
  <span class="property">"statistics"</span>: {
    <span class="property">"compositions"</span>: <span class="number">31</span>,
    <span class="property">"layers"</span>: <span class="number">293</span>,
    <span class="property">"keyframes"</span>: <span class="number">112</span>,
    <span class="property">"effects"</span>: <span class="number">88</span>
  },
  <span class="property">"details"</span>: {
    <span class="property">"compositions"</span>: [<span class="string">"å¼€èŠ±1"</span>, <span class="string">"å¼€èŠ±2"</span>, ...],
    <span class="property">"layers"</span>: [<span class="string">"å³ç¿…è†€"</span>, <span class="string">"å·¦ç¿…è†€"</span>, ...],
    <span class="property">"keyframes"</span>: {
      <span class="property">"å³ç¿…è†€"</span>: <span class="number">9</span>,
      <span class="property">"å·¦ç¿…è†€"</span>: <span class="number">9</span>,
      <span class="property">"å·¦çŒ«è€³"</span>: <span class="number">15</span>
    },
    <span class="property">"effects"</span>: [<span class="string">"Keylight (1.2)"</span>, <span class="string">"ç®€å•é˜»å¡å·¥å…·"</span>, ...]
  }
}
                    </div>
                </div>
            </div>

            <!-- ç¬¬äºŒæ­¥ï¼šä¸Šä¼ åˆ° Cloudflare Worker -->
            <div class="section">
                <h2><span class="icon">2ï¸âƒ£</span> ç¬¬äºŒæ­¥ï¼šä¸Šä¼ æ•°æ®åˆ° Cloudflare Worker</h2>
                <div class="step">
                    <h3>2.1 è¯»å–æœ¬åœ° JSON æ–‡ä»¶</h3>
                    <p>AE æ‰©å±•çš„ <code>emailManager.js</code> å®šæœŸï¼ˆæ¯åˆ†é’Ÿï¼‰è¯»å–æ–‡æ¡£ç›®å½•ä¸­çš„æ‰€æœ‰ JSON æ–‡ä»¶ï¼š</p>
                    <div class="code-block">
<span class="comment">// emailManager.js - getCurrentWorkData å‡½æ•°</span>
<span class="keyword">var</span> baseFolder = userPath + separator + <span class="string">'RuAlive@çƒŸå›±é¸­'</span>;
<span class="comment">// é€’å½’è¯»å–æ‰€æœ‰å­æ–‡ä»¶å¤¹ä¸­çš„ JSON æ–‡ä»¶</span>
<span class="keyword">function</span> readFolder(folderPath) {
  <span class="comment">// ... è¯»å–é€»è¾‘</span>
  <span class="keyword">if</span> (file.name.indexOf(<span class="string">'.json'</span>) !== -1) {
    <span class="keyword">var</span> data = JSON.parse(content);
    <span class="comment">// ä»æ–‡ä»¶åä¸­æå–æ—¥æœŸ</span>
    <span class="keyword">var</span> dateMatch = file.name.match(/(\d{4}-\d{2}-\d{2})/);
    <span class="keyword">if</span> (dateMatch) {
      <span class="keyword">var</span> date = dateMatch[<span class="number">1</span>];
      <span class="comment">// æŒ‰æ—¥æœŸåˆ†ç»„æ•°æ®</span>
      dataByDate[date].projects.push({
        <span class="property">projectId</span>: data.projectId,
        <span class="property">name</span>: data.name,
        <span class="property">statistics</span>: data.statistics,
        <span class="property">details</span>: data.details  <span class="comment">// â† å…³é”®ï¼šåŒ…å«è¯¦ç»†æ•°æ®</span>
      });
    }
  }
}
                    </div>
                </div>

                <div class="step">
                    <h3>2.2 å‘é€åˆ° Cloudflare Worker API</h3>
                    <p>æ‰©å±•å°†æ•´ç†å¥½çš„æ•°æ®å‘é€åˆ°åç«¯ APIï¼š</p>
                    <div class="code-block">
<span class="comment">// å‘é€è¯·æ±‚åˆ° Cloudflare Worker</span>
<span class="keyword">var</span> payload = {
  <span class="property">"userId"</span>: <span class="string">"user_xxx"</span>,
  <span class="property">"workData"</span>: {
    <span class="property">"work_hours"</span>: <span class="number">7.66</span>,
    <span class="property">"keyframe_count"</span>: <span class="number">112</span>,
    <span class="property">"json_size"</span>: <span class="number">9579</span>,
    <span class="property">"project_count"</span>: <span class="number">2</span>,
    <span class="property">"composition_count"</span>: <span class="number">35</span>,
    <span class="property">"layer_count"</span>: <span class="number">343</span>,
    <span class="property">"effect_count"</span>: <span class="number">98</span>,
    <span class="property">"projects"</span>: [
      {
        <span class="property">"projectId"</span>: <span class="string">"240c62c4"</span>,
        <span class="property">"name"</span>: <span class="string">"52000é’»-ç‚½æ‹å¼¦æ­Œ.aep"</span>,
        <span class="property">"statistics"</span>: { ... },
        <span class="property">"details"</span>: { ... }  <span class="comment">// â† è¯¦ç»†æ•°æ®</span>
      }
    ]
  },
  <span class="property">"workDate"</span>: <span class="string">"2026-01-19"</span>
};

fetch(<span class="string">'https://rualive-email-worker.cubetan57.workers.dev/api/work-data'</span>, {
  <span class="property">method</span>: <span class="string">'POST'</span>,
  <span class="property">headers</span>: {
    <span class="property">'Content-Type'</span>: <span class="string">'application/json'</span>,
    <span class="property">'Authorization'</span>: <span class="string">'Bearer '</span> + token
  },
  <span class="property">body</span>: JSON.stringify(payload)
});
                    </div>
                </div>
            </div>

            <!-- ç¬¬ä¸‰æ­¥ï¼šCloudflare Worker å¤„ç†æ•°æ® -->
            <div class="section">
                <h2><span class="icon">3ï¸âƒ£</span> ç¬¬ä¸‰æ­¥ï¼šCloudflare Worker å¤„ç†å¹¶å­˜å‚¨æ•°æ®</h2>
                <div class="step">
                    <h3>3.1 æ¥æ”¶ API è¯·æ±‚</h3>
                    <p>Worker çš„ <code>index.js</code> æ¥æ”¶è¯·æ±‚å¹¶è°ƒç”¨ <code>saveWorkData</code> å‡½æ•°ï¼š</p>
                    <div class="code-block">
<span class="comment">// index.js - å¤„ç† /api/work-data è¯·æ±‚</span>
<span class="keyword">if</span> (path === <span class="string">'/api/work-data'</span> && request.method === <span class="string">'POST'</span>) {
  <span class="keyword">const</span> body = <span class="keyword">await</span> request.json();
  <span class="keyword">const</span> userId = body.userId;
  <span class="keyword">const</span> workData = body.workData;
  <span class="keyword">const</span> workDate = body.workDate;
  
  <span class="comment">// ä¿å­˜åˆ°æ•°æ®åº“</span>
  <span class="keyword">await</span> saveWorkData(userId, workData, env, workDate);
}
                    </div>
                </div>

                <div class="step">
                    <h3>3.2 æå–è¯¦ç»†æ•°æ®</h3>
                    <p><code>saveWorkData</code> å‡½æ•°ä» <code>projects</code> æ•°ç»„ä¸­æå–è¯¦ç»†æ•°æ®ï¼š</p>
                    <div class="code-block">
<span class="comment">// index.js - saveWorkData å‡½æ•°</span>
<span class="keyword">const</span> allCompositions = [];
<span class="keyword">const</span> allEffects = [];
<span class="keyword">const</span> allLayers = [];
<span class="keyword">const</span> allKeyframes = [];
<span class="keyword">const</span> allProjects = [];
<span class="keyword">const</span> allWorkHours = [];

workData.projects.<span class="keyword">forEach</span>(<span class="keyword">function</span>(project) {
  <span class="comment">// é¡¹ç›®åˆ—è¡¨</span>
  allProjects.push({
    <span class="property">name</span>: project.name,
    <span class="property">path</span>: project.path || <span class="string">''</span>,
    <span class="property">compositions</span>: project.statistics.compositions || <span class="number">0</span>,
    <span class="property">layers</span>: project.statistics.layers || <span class="number">0</span>,
    <span class="property">keyframes</span>: project.statistics.keyframes || <span class="number">0</span>,
    <span class="property">effects</span>: project.statistics.effects || <span class="number">0</span>
  });

  <span class="comment">// å·¥ä½œæ—¶é•¿åˆ—è¡¨</span>
  <span class="keyword">if</span> (project.accumulatedRuntime) {
    allWorkHours.push({
      <span class="property">project</span>: project.name,
      <span class="property">hours</span>: (project.accumulatedRuntime / <span class="number">3600</span>).toFixed(<span class="number">2</span>)
    });
  }

  <span class="comment">// åˆæˆåˆ—è¡¨</span>
  <span class="keyword">if</span> (project.statistics.compositions) {
    allCompositions.push({
      <span class="property">project</span>: project.name,
      <span class="property">count</span>: project.statistics.compositions
    });
  }

  <span class="comment">// æ•ˆæœåˆ—è¡¨</span>
  <span class="keyword">if</span> (project.details.effects) {
    project.details.effects.<span class="keyword">forEach</span>(<span class="keyword">function</span>(effectName) {
      allEffects.push({
        <span class="property">project</span>: project.name,
        <span class="property">name</span>: effectName
      });
    });
  }

  <span class="comment">// å›¾å±‚åˆ—è¡¨å’Œå…³é”®å¸§åˆ—è¡¨ï¼ˆç±»ä¼¼å¤„ç†ï¼‰</span>
});
                    </div>
                </div>

                <div class="step">
                    <h3>3.3 ä¿å­˜åˆ° D1 æ•°æ®åº“</h3>
                    <p>å°†æå–çš„æ•°æ®ä¿å­˜åˆ° SQLite æ•°æ®åº“ï¼š</p>
                    <div class="code-block">
<span class="comment">// æ„å»º JSON å­—ç¬¦ä¸²</span>
<span class="keyword">const</span> compositionsJson = allCompositions.length > <span class="number">0</span> 
  ? JSON.stringify(allCompositions) : <span class="keyword">null</span>;
<span class="keyword">const</span> effectsJson = allEffects.length > <span class="number">0</span> 
  ? JSON.stringify(allEffects) : <span class="keyword">null</span>;
<span class="comment">// ... å…¶ä»–å­—æ®µ</span>

<span class="comment">// æ’å…¥æˆ–æ›´æ–°æ•°æ®åº“</span>
<span class="keyword">await</span> DB.prepare(`
  INSERT INTO work_logs (
    user_id, work_date, work_hours, keyframe_count, json_size,
    project_count, composition_count, layer_count, effect_count,
    compositions_json, effects_json, layers_json, keyframes_json,
    projects_json, work_hours_json
  ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
  ON CONFLICT(user_id, work_date) DO UPDATE SET
    work_hours = excluded.work_hours,
    compositions_json = excluded.compositions_json,
    effects_json = excluded.effects_json,
    -- ... å…¶ä»–å­—æ®µ
`).bind(
  userId, workDate,
  workData.work_hours || <span class="number">0</span>,
  workData.keyframe_count || <span class="number">0</span>,
  workData.json_size || <span class="number">0</span>,
  workData.project_count || <span class="number">0</span>,
  workData.composition_count || <span class="number">0</span>,
  workData.layer_count || <span class="number">0</span>,
  workData.effect_count || <span class="number">0</span>,
  compositionsJson,
  effectsJson,
  layersJson,
  keyframesJson,
  projectsJson,
  workHoursJson
).run();
                    </div>
                </div>

                <div class="step">
                    <h3>3.4 æ•°æ®åº“è¡¨ç»“æ„</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>å­—æ®µå</th>
                                <th>ç±»å‹</th>
                                <th>è¯´æ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>id</td>
                                <td>INTEGER</td>
                                <td>ä¸»é”®ï¼Œè‡ªå¢</td>
                            </tr>
                            <tr>
                                <td>user_id</td>
                                <td>TEXT</td>
                                <td>ç”¨æˆ·ID</td>
                            </tr>
                            <tr>
                                <td>work_date</td>
                                <td>TEXT</td>
                                <td>å·¥ä½œæ—¥æœŸ (YYYY-MM-DD)</td>
                            </tr>
                            <tr>
                                <td>work_hours</td>
                                <td>REAL</td>
                                <td>æ€»å·¥ä½œæ—¶é•¿ï¼ˆå°æ—¶ï¼‰</td>
                            </tr>
                            <tr>
                                <td>keyframe_count</td>
                                <td>INTEGER</td>
                                <td>æ€»å…³é”®å¸§æ•°</td>
                            </tr>
                            <tr>
                                <td>project_count</td>
                                <td>INTEGER</td>
                                <td>é¡¹ç›®æ•°é‡</td>
                            </tr>
                            <tr>
                                <td>composition_count</td>
                                <td>INTEGER</td>
                                <td>æ€»åˆæˆæ•°</td>
                            </tr>
                            <tr>
                                <td>layer_count</td>
                                <td>INTEGER</td>
                                <td>æ€»å›¾å±‚æ•°</td>
                            </tr>
                            <tr>
                                <td>effect_count</td>
                                <td>INTEGER</td>
                                <td>æ€»æ•ˆæœæ•°</td>
                            </tr>
                            <tr>
                                <td>compositions_json</td>
                                <td>TEXT</td>
                                <td>åˆæˆåˆ—è¡¨ JSON</td>
                            </tr>
                            <tr>
                                <td>effects_json</td>
                                <td>TEXT</td>
                                <td>æ•ˆæœåˆ—è¡¨ JSON</td>
                            </tr>
                            <tr>
                                <td>layers_json</td>
                                <td>TEXT</td>
                                <td>å›¾å±‚åˆ—è¡¨ JSON</td>
                            </tr>
                            <tr>
                                <td>keyframes_json</td>
                                <td>TEXT</td>
                                <td>å…³é”®å¸§åˆ—è¡¨ JSON</td>
                            </tr>
                            <tr>
                                <td>projects_json</td>
                                <td>TEXT</td>
                                <td>é¡¹ç›®åˆ—è¡¨ JSON</td>
                            </tr>
                            <tr>
                                <td>work_hours_json</td>
                                <td>TEXT</td>
                                <td>å·¥ä½œæ—¶é•¿åˆ—è¡¨ JSON</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ç¬¬å››æ­¥ï¼šå‰ç«¯è¯»å–æ•°æ® -->
            <div class="section">
                <h2><span class="icon">4ï¸âƒ£</span> ç¬¬å››æ­¥ï¼šå‰ç«¯è¯»å–å¹¶æ˜¾ç¤ºæ•°æ®</h2>
                <div class="step">
                    <h3>4.1 å‰ç«¯ä»£ç å­˜å‚¨</h3>
                    <p>å‰ç«¯ä»£ç ï¼ˆHTMLã€CSSã€JSï¼‰æ„å»ºåå­˜å‚¨åœ¨ Cloudflare KV ä¸­ï¼š</p>
                    <div class="code-block">
<span class="comment">// æ„å»ºå‰ç«¯ä»£ç </span>
node scripts/build-dashboard.js

<span class="comment">// ä¸Šä¼ åˆ° KV</span>
npx wrangler kv:key put --binding=KV <span class="string">"user-dashboard-inline"</span> \
  --path=./src/user-dashboard/index-inline.html

<span class="comment">// KV é”®åï¼šuser-dashboard-inline</span>
<span class="comment">// KV å€¼ï¼šå®Œæ•´çš„å†…è” HTML ä»£ç ï¼ˆçº¦ 80KBï¼‰</span>
                    </div>
                </div>

                <div class="step">
                    <h3>4.2 ç”¨æˆ·è®¿é—®é¢æ¿</h3>
                    <p>ç”¨æˆ·è®¿é—® https://rualive-email-worker.cubetan57.workers.dev æ—¶ï¼š</p>
                    <div class="code-block">
<span class="comment">// Worker è¿”å› KV ä¸­çš„ HTML</span>
<span class="keyword">if</span> (url.pathname === <span class="string">'/'</span> || url.pathname === <span class="string">'/dashboard'</span>) {
  <span class="keyword">const</span> html = <span class="keyword">await</span> env.KV.get(<span class="string">'user-dashboard-inline'</span>);
  <span class="keyword">return new</span> Response(html, {
    <span class="property">headers</span>: { <span class="property">'Content-Type'</span>: <span class="string">'text/html; charset=utf-8'</span> }
  });
}
                    </div>
                </div>

                <div class="step">
                    <h3>4.3 è·å–å·¥ä½œæ—¥å¿—æ•°æ®</h3>
                    <p>å‰ç«¯é€šè¿‡ API è·å–å·¥ä½œæ—¥å¿—ï¼š</p>
                    <div class="code-block">
<span class="comment">// logs-table.js - è·å–æ‰€æœ‰å·¥ä½œæ—¥å¿—</span>
<span class="keyword">async</span> <span class="keyword">function</span> updateDashboard() {
  <span class="keyword">const</span> token = localStorage.getItem(<span class="string">'token'</span>);
  
  <span class="comment">// è·å–æ‰€æœ‰å·¥ä½œæ—¥å¿—ï¼ˆä¸åŒ…å«è¯¦ç»†æ•°æ®ï¼‰</span>
  <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'/api/work-logs'</span>, {
    <span class="property">headers</span>: {
      <span class="property">'Authorization'</span>: <span class="string">'Bearer '</span> + token
    }
  });
  
  <span class="keyword">const</span> result = <span class="keyword">await</span> response.json();
  <span class="keyword">const</span> data = result.data;
  
  <span class="comment">// æ›´æ–°è¡¨æ ¼æ˜¾ç¤º</span>
  window.logsTable.update(data);
}

<span class="comment">// è·å–ç‰¹å®šæ—¥æœŸçš„è¯¦ç»†æ•°æ®</span>
<span class="keyword">async</span> <span class="keyword">function</span> showDetailList(date, type) {
  <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">`/api/work-logs?date=${date}`</span>, {
    <span class="property">headers</span>: {
      <span class="property">'Authorization'</span>: <span class="string">'Bearer '</span> + token
    }
  });
  
  <span class="keyword">const</span> result = <span class="keyword">await</span> response.json();
  <span class="keyword">const</span> log = result.data[<span class="number">0</span>];
  
  <span class="comment">// æ ¹æ® type è§£æå¯¹åº”çš„ JSON å­—æ®µ</span>
  <span class="keyword">let</span> jsonData;
  <span class="keyword">switch</span>(type) {
    <span class="keyword">case</span> <span class="string">'compositions'</span>:
      jsonData = JSON.parse(log.compositions_json);
      <span class="keyword">break</span>;
    <span class="keyword">case</span> <span class="string">'effects'</span>:
      jsonData = JSON.parse(log.effects_json);
      <span class="keyword">break</span>;
    <span class="comment">// ... å…¶ä»–ç±»å‹</span>
  }
  
  <span class="comment">// æ˜¾ç¤ºåˆ—è¡¨</span>
  showListModal(title, jsonData, columns);
}
                    </div>
                </div>

                <div class="step">
                    <h3>4.4 Worker è¿”å›æ•°æ®</h3>
                    <p>Worker ä» D1 æ•°æ®åº“æŸ¥è¯¢å¹¶è¿”å›æ•°æ®ï¼š</p>
                    <div class="code-block">
<span class="comment">// index.js - handleGetWorkLogs å‡½æ•°</span>
<span class="keyword">async function</span> handleGetWorkLogs(request, env) {
  <span class="keyword">const</span> payload = <span class="keyword">await</span> verifyAuth(request, env);
  <span class="keyword">const</span> userId = payload.userId;
  <span class="keyword">const</span> url = <span class="keyword">new</span> URL(request.url);
  <span class="keyword">const</span> date = url.searchParams.get(<span class="string">'date'</span>);
  
  <span class="keyword">let</span> result;
  <span class="keyword">if</span> (date) {
    <span class="comment">// è·å–ç‰¹å®šæ—¥æœŸçš„è¯¦ç»†æ•°æ®</span>
    result = <span class="keyword">await</span> DB.prepare(
      <span class="string">'SELECT * FROM work_logs WHERE user_id = ? AND work_date = ?'</span>
    ).bind(userId, date).all();
  } <span class="keyword">else</span> {
    <span class="comment">// è·å–æ‰€æœ‰å·¥ä½œæ—¥å¿—ï¼ˆä¸åŒ…å«è¯¦ç»†æ•°æ®ï¼‰</span>
    result = <span class="keyword">await</span> DB.prepare(
      <span class="string">'SELECT id, user_id, work_date, work_hours, keyframe_count, json_size, project_count, composition_count, layer_count, effect_count FROM work_logs WHERE user_id = ? ORDER BY work_date DESC'</span>
    ).bind(userId).all();
  }
  
  <span class="keyword">return</span> Response.json({ 
    <span class="property">success</span>: <span class="keyword">true</span>, 
    <span class="property">data</span>: result.results || [] 
  });
}
                    </div>
                </div>
            </div>

            <!-- æ•°æ®æµè½¬ç¤ºä¾‹ -->
            <div class="section">
                <h2><span class="icon">ğŸ“ˆ</span> å®Œæ•´æ•°æ®æµè½¬ç¤ºä¾‹</h2>
                <div class="step">
                    <h3>ç¤ºä¾‹ï¼šæŸ¥çœ‹ 2026-01-19 çš„æ•ˆæœåˆ—è¡¨</h3>
                    <ol style="margin-left: 20px; line-height: 2;">
                        <li><strong>AE æ‰©å±•</strong>ï¼šæ‰«æé¡¹ç›®ï¼Œç”Ÿæˆ JSON æ–‡ä»¶ï¼ŒåŒ…å« <code>details.effects</code> æ•°ç»„</li>
                        <li><strong>ä¸Šä¼ </strong>ï¼šæ‰©å±•æ¯åˆ†é’Ÿè‡ªåŠ¨ä¸Šä¼ æ•°æ®åˆ° Cloudflare Worker</li>
                        <li><strong>å¤„ç†</strong>ï¼šWorker ä» <code>projects.details.effects</code> æå–æ•ˆæœåˆ—è¡¨</li>
                        <li><strong>å­˜å‚¨</strong>ï¼šå°†æ•ˆæœåˆ—è¡¨åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ï¼Œä¿å­˜åˆ° <code>effects_json</code> å­—æ®µ</li>
                        <li><strong>å‰ç«¯</strong>ï¼šç”¨æˆ·åŒå‡»"æ•ˆæœæ•°é‡"å¡ç‰‡ï¼Œè°ƒç”¨ <code>/api/work-logs?date=2026-01-19</code></li>
                        <li><strong>æŸ¥è¯¢</strong>ï¼šWorker ä»æ•°æ®åº“æŸ¥è¯¢è¯¥æ—¥æœŸçš„æ‰€æœ‰å­—æ®µ</li>
                        <li><strong>è§£æ</strong>ï¼šå‰ç«¯è§£æ <code>log.effects_json</code>ï¼Œæ˜¾ç¤ºæ•ˆæœåˆ—è¡¨</li>
                    </ol>
                </div>

                <div class="note">
                    <div class="note-title">ğŸ’¡ é‡è¦æç¤º</div>
                    <p>AE æ‰©å±•éœ€è¦é‡æ–°åŠ è½½æ‰èƒ½ä½¿ç”¨æœ€æ–°ä»£ç ä¸Šä¼ è¯¦ç»†æ•°æ®ã€‚å¦‚æœæ‰©å±•ä½¿ç”¨æ—§ä»£ç ï¼Œä¸Šä¼ çš„æ•°æ®å°†ä¸åŒ…å« <code>details</code> å­—æ®µï¼Œå¯¼è‡´è¯¦ç»†æ•°æ®æ˜¾ç¤ºä¸ºç©ºã€‚</p>
                </div>

                <div class="warning">
                    <div class="warning-title">âš ï¸ æ³¨æ„äº‹é¡¹</div>
                    <ul>
                        <li>AE æ‰©å±•æ¯åˆ†é’Ÿè‡ªåŠ¨ä¸Šä¼ ä¸€æ¬¡æ•°æ®ï¼Œä¼šè¦†ç›–æ•°æ®åº“ä¸­çš„ç°æœ‰è®°å½•</li>
                        <li>æµ‹è¯•æ•°æ®ä¼šè¢«å®é™…ä¸Šä¼ æ•°æ®è¦†ç›–</li>
                        <li>å‰ç«¯ä»£ç å­˜å‚¨åœ¨ KV ä¸­ï¼Œä¿®æ”¹åéœ€è¦é‡æ–°æ„å»ºå’Œä¸Šä¼ </li>
                        <li>æ•°æ®åº“ä½¿ç”¨ SQLiteï¼ŒJSON å­—æ®µå­˜å‚¨ä¸º TEXT ç±»å‹</li>
                    </ul>
                </div>
            </div>

            <!-- æŠ€æœ¯æ¶æ„ -->
            <div class="section">
                <h2><span class="icon">ğŸ—ï¸</span> æŠ€æœ¯æ¶æ„</h2>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ç»„ä»¶</th>
                            <th>æŠ€æœ¯</th>
                            <th>ä½œç”¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>AE æ‰©å±•</td>
                            <td>CEP + JSX</td>
                            <td>æ‰«æ AE é¡¹ç›®ï¼Œç”Ÿæˆ JSONï¼Œä¸Šä¼ æ•°æ®</td>
                        </tr>
                        <tr>
                            <td>Cloudflare Worker</td>
                            <td>JavaScript</td>
                            <td>API æœåŠ¡å™¨ï¼Œå¤„ç†è¯·æ±‚ï¼Œæ•°æ®è½¬æ¢</td>
                        </tr>
                        <tr>
                            <td>D1 æ•°æ®åº“</td>
                            <td>SQLite</td>
                            <td>å­˜å‚¨å·¥ä½œæ—¥å¿—å’Œè¯¦ç»†æ•°æ®</td>
                        </tr>
                        <tr>
                            <td>KV å­˜å‚¨</td>
                            <td>Key-Value</td>
                            <td>å­˜å‚¨å‰ç«¯ HTML ä»£ç </td>
                        </tr>
                        <tr>
                            <td>ç”¨æˆ·é¢æ¿</td>
                            <td>HTML + CSS + JS</td>
                            <td>æ•°æ®å±•ç¤ºå’Œç”¨æˆ·äº¤äº’</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="footer">
            <p>RuAlive æ•°æ®æµç¨‹è¯´æ˜ | ç”Ÿæˆæ—¶é—´ï¼š2026-01-19</p>
        </div>
    </div>
</body>
</html>